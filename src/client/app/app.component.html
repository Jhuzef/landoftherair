<nav class="navbar navbar-expand-lg navbar-light bg-faded">
  <a class="navbar-brand" href="#">
    <span>Land of the Rair</span>
    <span *ngIf="colyseus.lobby.myAccount.username">- {{ colyseus.lobby.myAccount.username }}</span>
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item" *ngIf="colyseus.lobby.myAccount" dropdown container="body">
        <a class="nav-link" href="#" dropdownToggle>Game {{ colyseus.isConnected ? '' : '(Disconnected)' }}</a>

        <ul *dropdownMenu class="dropdown-menu">
          <li>
            <a class="dropdown-item" (click)="colyseus.lobby.logout()">Logout</a>
          </li>
        </ul>

      </li>
    </ul>

    <ul class="navbar-nav" *ngIf="inGame">
      <li class="nav-item" *ngIf="colyseus.lobby.myAccount" dropdown container="body">
        <a class="nav-link" href="#" dropdownToggle>Windows</a>

        <ul *dropdownMenu class="dropdown-menu">
          <li>
            <a class="dropdown-item" (click)="showStatsWindow = !showStatsWindow">Stats</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="showSkillsWindow = !showSkillsWindow">Skills</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="showCommandLine = !showCommandLine">Command Line</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="showInventoryBelt = !showInventoryBelt">Belt</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="showInventorySack = !showInventorySack">Sack</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="showEquipment = !showEquipment">Equipment</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="options.show()">Options</a>
          </li>
        </ul>

      </li>
    </ul>

    <ul class="navbar-nav mr-auto" *ngIf="inGame">
      <li class="nav-item" *ngIf="colyseus.lobby.myAccount" dropdown container="body">
        <a class="nav-link" href="#" dropdownToggle>Macros</a>

        <ul *dropdownMenu class="dropdown-menu">
          <li>
            <a class="dropdown-item" (click)="macros.show()">Macros</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="macroGroups.show()">Macro Groups</a>
          </li>
        </ul>

      </li>
    </ul>
  </div>
</nav>

<div class="body-container" [class.option-overflow]="true">

  <div *ngIf="!colyseus.isConnected" class="m-5 d-flex justify-content-center align-content-center h-100">
    <div class="alert alert-warning connection-warning">
      The game client could not connect to the server. The game may be down for maintenance. Refresh the page to attempt to reconnect.
    </div>
  </div>

  <div class="window lobby game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="lobbyDrag"
       windowName="lobby"
       defaultX="576"
       defaultY="55"
       [class.minimized]="minimized['lobby']"
       [class.hidden]="!loggedIn || !colyseus.username || !colyseus.isConnected || (inGame && autoHideLobby)">
    <div class="window-header text-center" #lobbyDrag>
      Lobby Chat ({{ colyseus.lobby.lobbyState.accounts.length }} Online)
      <app-minimize-button (click)="minimize('lobby')"></app-minimize-button>
    </div>
    <div class="window-body" [class.hidden]="minimized['lobby']">
      <app-lobby></app-lobby>
    </div>
  </div>

  <div class="window character-select"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="characterSelectDrag"
       windowName="chararacterSelect"
       defaultX="0"
       defaultY="55"
       [class.hidden]="!loggedIn || inGame || !colyseus.username || !colyseus.isConnected">
    <div class="window-header text-center" #characterSelectDrag>Character Select</div>
    <div class="window-body">
      <app-character-select [resourcesLoaded]="resourcesLoaded"></app-character-select>
    </div>
  </div>

  <div class="window map"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="mapDrag"
       windowName="map"
       defaultX="389"
       defaultY="56"
       [class.hidden]="!inGame">
    <div class="window-header text-center" #mapDrag>
      World
      <app-close-button (click)="colyseus.game.quit()"></app-close-button>
    </div>
    <div class="window-body">
      <app-active-target *ngIf="showActiveTarget"></app-active-target>
      <app-map [clientGameState]="colyseus.game.clientGameState" [currentPlayer]="colyseus.game.character"
               [class.hidden]="colyseus.game.isChangingMap"></app-map>
    </div>
  </div>

  <div class="window stats above-game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="statsDrag"
       windowName="stats"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showStatsWindow">
    <div class="window-header text-center" #statsDrag>
      Stats
      <app-close-button (click)="showStatsWindow = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-stats-window [currentPlayer]="colyseus.game.character"></app-stats-window>
    </div>
  </div>

  <div class="window skills above-game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="skillsDrag"
       windowName="skills"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showSkillsWindow">
    <div class="window-header text-center" #skillsDrag>
      Skills
      <app-close-button (click)="showSkillsWindow = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-skills-window [currentPlayer]="colyseus.game.character"></app-skills-window>
    </div>
  </div>

  <div class="window command-line game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="commandLine"
       windowName="commandLine"
       defaultX="389"
       defaultY="848"
       *ngIf="inGame && showCommandLine">
    <div class="window-header text-center" #commandLine>
      Command Line
      <app-close-button (click)="showCommandLine = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-command-line [rightClickSend]="rightClickSend"></app-command-line>
    </div>
  </div>

  <div class="window log-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[logWindowSize]"
       [windowHandle]="logWindow"
       windowName="logWindow"
       defaultX="3"
       defaultY="365"
       *ngIf="inGame">
    <div class="window-header text-center" #logWindow>
      Log
    </div>
    <div class="window-body">
      <app-log-window [clientGameState]="colyseus.game.clientGameState" [windowSize]="logWindowSize"
                      [fontSize]="logFontSize"></app-log-window>
    </div>
  </div>

  <div class="window status-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="statusWindow"
       windowName="statusWindow"
       defaultX="389"
       defaultY="743"
       [class.minimized]="minimized['status']"
       *ngIf="inGame">
    <div class="window-header text-center" #statusWindow>
      <app-character-tagline [player]="colyseus.game.character"></app-character-tagline>
      <app-minimize-button (click)="minimize('status')"></app-minimize-button>
    </div>
    <div class="window-body" [class.hidden]="minimized['status']">
      <app-status-window></app-status-window>
    </div>
  </div>

  <div class="window ground-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[groundSize]"
       [windowHandle]="groundWindow"
       windowName="groundWindow"
       defaultX="3"
       defaultY="619"
       *ngIf="inGame && colyseus.game.showGround">
    <div class="window-header text-center" #groundWindow>
      Ground
      <app-close-button (click)="colyseus.game.showGround = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-ground [size]="groundSize"></app-ground>
    </div>
  </div>

  <div class="window inventory-sack-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[sackSize]"
       [windowHandle]="sackWindow"
       windowName="sackWindow"
       defaultX="966"
       defaultY="538"
       *ngIf="inGame && showInventorySack">
    <div class="window-header text-center" #sackWindow>
      Inventory - Sack
      <app-close-button (click)="showInventorySack = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-inventory-sack [size]="sackSize" [player]="colyseus.game.character"></app-inventory-sack>
    </div>
  </div>

  <div class="window inventory-belt-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[beltSize]"
       [windowHandle]="beltWindow"
       windowName="beltWindow"
       defaultX="966"
       defaultY="433"
       *ngIf="inGame && showInventoryBelt">
    <div class="window-header text-center" #beltWindow>
      Inventory - Belt
      <app-close-button (click)="showInventoryBelt = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-inventory-belt [size]="beltSize" [player]="colyseus.game.character"></app-inventory-belt>
    </div>
  </div>

  <div class="window equipment-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[equipmentSize]"
       [windowHandle]="equipmentWindow"
       windowName="equipmentWindow"
       defaultX="966"
       defaultY="56"
       *ngIf="inGame && showEquipment">
    <div class="window-header text-center" #equipmentWindow>
      Equipment
      <app-close-button (click)="showEquipment = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-equipment [player]="colyseus.game.character" [size]="equipmentSize"></app-equipment>
    </div>
  </div>

  <div class="window npc-window game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[npcWindowSize]"
       [windowHandle]="npcWindow"
       windowName="npcWindow"
       defaultX="3"
       defaultY="56"
       *ngIf="inGame">
    <div class="window-header text-center" #npcWindow>
      NPCs
    </div>
    <div class="window-body">
      <app-npcs></app-npcs>
    </div>
  </div>

  <div class="window macro-bars game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="macroBars"
       windowName="macroBars"
       defaultX="389"
       defaultY="661"
       *ngIf="inGame">
    <div class="window-header text-center" #macroBars>
      Macros
    </div>
    <div class="window-body">
      <app-macro-bars></app-macro-bars>
    </div>
  </div>

  <div class="window trainer above-game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="trainerDrag"
       windowName="trainer"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showTrainer.uuid">
    <div class="window-header text-center" #trainerDrag>
      {{ colyseus.game.showTrainer.classTrain }} Guide
      <app-close-button (click)="colyseus.game.showTrainer = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-trainer></app-trainer>
    </div>
  </div>

  <div class="window shop above-game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="shopDrag"
       windowName="shop"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showShop.uuid">
    <div class="window-header text-center" #shopDrag>
      Shop
      <app-close-button (click)="colyseus.game.showShop = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-shop></app-shop>
    </div>
  </div>

  <div class="window bank above-game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="bankDrag"
       windowName="bank"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showBank.uuid">
    <div class="window-header text-center" #bankDrag>
      {{ colyseus.game.showBank.bankId }} Bank
      <app-close-button (click)="colyseus.game.showBank = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-bank></app-bank>
    </div>
  </div>

  <div class="window locker above-game-window"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="lockerDrag"
       windowName="locker"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showLocker.length > 0">
    <div class="window-header text-center" #lockerDrag>
      {{ colyseus.game.showLocker[0].regionId }} Region Wardrobe
      <app-close-button (click)="colyseus.game.showLocker = []"></app-close-button>
    </div>
    <div class="window-body">
      <app-lockers></app-lockers>
    </div>
  </div>

</div>

<div class="modal fade" bsModal #options="bs-modal" tabindex="-1" (onShow)="optionsModalVisible = true"
     (onHide)="optionsModalVisible = false">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title pull-left">Options</h3>
        <button type="button" class="close pull-right" (click)="options.hide()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="optionsModalVisible">
        <div class="row">
          <div class="col text-center"><h4>UI Window Sizes</h4></div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Sack Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Belt Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Equipment Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Ground Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Log Font Size</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="xlarge">Gigantic</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="large">Large</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Log Window Size</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="max">Max</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="xlarge">Gigantic</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="large">Large</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">NPC Window Size</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="max">Max</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="xlarge">Gigantic</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="large">Large</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col text-center"><h4>UI Options</h4></div>
        </div>

        <div class="row">
          <div class="col-3 text-right font-weight-bold">Theme</div>
          <div class="col form-check">
            <select class="form-control" [(ngModel)]="theme" disabled>
              <option [value]="'Light'">Light</option>
              <option [value]="'Dark'">Dark</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="rightClickSend">
              <input type="checkbox" class="form-check-input" [(ngModel)]="rightClickSend" id="rightClickSend"/>
              Right-click to send command line
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="autoHideLobby">
              <input type="checkbox" class="form-check-input" [(ngModel)]="autoHideLobby" id="autoHideLobby"/>
              Hide lobby while game is open
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="lockWindowPositions">
              <input type="checkbox" class="form-check-input" [(ngModel)]="lockWindowPositions" id="lockWindowPositions"/>
              Lock All Window Positions
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="suppressZeroDamage">
              <input type="checkbox" class="form-check-input" [(ngModel)]="suppressZeroDamage" id="suppressZeroDamage"/>
              Suppress 0-damage messages
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="showActiveTarget">
              <input type="checkbox" class="form-check-input" [(ngModel)]="showActiveTarget" id="showActiveTarget"/>
              Show Current Target Information (Ctrl-Click to select without attacking)
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="pinLastTarget">
              <input type="checkbox" class="form-check-input" [(ngModel)]="pinLastTarget" id="pinLastTarget"/>
              Pin Last Target Click Position
            </label>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col text-center"><h4>Audio Options</h4></div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="playBackgroundMusic">
              <input type="checkbox" class="form-check-input" [(ngModel)]="playBackgroundMusic" id="playBackgroundMusic"/>
              Play Background Music
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="playSoundEffects">
              <input type="checkbox" class="form-check-input" [(ngModel)]="playSoundEffects" id="playSoundEffects"/>
              Play Sound Effects
            </label>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #macros="bs-modal" tabindex="-1" (onShow)="showMacroModal()"
     (onHide)="macroModalVisible = false">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">All Macros</h3>
        <button type="button" class="close pull-right" (click)="macros.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body macro-list-body" *ngIf="macroService.hasLoaded && macroModalVisible">
        <div class="row mb-1" *ngFor="let macro of macroService.allMacroNames()">
          <div class="col-2">
            <app-icon [name]="macroService.allMacros[macro].icon"
                      [bgColor]="macroService.allMacros[macro].background || '#ccc'"
                      [fgColor]="macroService.allMacros[macro].foreground"
                      size="small"></app-icon>
          </div>
          <div class="col-6">
            {{ macro }}
          </div>
          <div class="col-4">
            <button class="btn btn-info btn-sm"
                    *ngIf="!macroService.allMacros[macro].isSystem" (click)="editMacro(macroService.allMacros[macro])">
              Edit
            </button>
            <button class="btn btn-danger btn-sm"
                    *ngIf="!macroService.allMacros[macro].isSystem"
                    (click)="deleteMacro(macroService.allMacros[macro])">Remove
            </button>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="addMacro()">New Macro</button>
        <button type="button" class="btn btn-secondary" (click)="macros.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #viewMacro="bs-modal" tabindex="-1" (onShow)="macroEditModalVisible = true"
     (onHide)="macroEditModalVisible = false">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Edit Macro</h3>
        <button type="button" class="close pull-right" (click)="viewMacro.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="macroEditModalVisible">

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Name</div>
          <div class="col-9">
            <input class="form-control" [(ngModel)]="currentlyEditingMacro.name" placeholder="Enter your macro name"/>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Macro</div>
          <div class="col-9">
            <textarea class="form-control" rows="3" [(ngModel)]="currentlyEditingMacro.macro"
                      placeholder="Enter your macro command. Separate multiple commands with semicolons"></textarea>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Key</div>
          <div class="col-3">
            <input class="form-control" [(ngModel)]="currentlyEditingMacro.key" (keydown)="setMacroKey($event)"
                   placeholder="Press Key"/>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.shift"
                    [class.btn-success]="currentlyEditingMacro.modifiers.shift"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.shift">Shift
            </button>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.ctrl"
                    [class.btn-success]="currentlyEditingMacro.modifiers.ctrl"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.ctrl">Ctrl
            </button>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.alt"
                    [class.btn-success]="currentlyEditingMacro.modifiers.alt"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.alt">Alt
            </button>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Mode</div>
          <div class="col-9">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.clickToTarget"
                    [class.btn-success]="currentlyEditingMacro.clickToTarget"
                    (click)="changeMacroMode('clickToTarget')"
                    tooltip="Clicking this macro will let you click an npc target"
            >Need Target
            </button>
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.autoActivate"
                    [class.btn-success]="currentlyEditingMacro.autoActivate"
                    (click)="changeMacroMode('autoActivate')"
                    tooltip="Clicking this macro will fire it instantly"
            >Instant
            </button>
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.lockActivation"
                    [class.btn-success]="currentlyEditingMacro.lockActivation"
                    (click)="changeMacroMode('lockActivation')"
                    tooltip="Clicking this macro will make it your default click action (similar to Attack)"
            >Locked
            </button>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">FG Color</div>
          <div class="col-3">
            <input class="form-control"
                   cpPosition="bottom"
                   cpAlphaChannel="disabled"
                   [(colorPicker)]="currentlyEditingMacro.foreground"
                   [style.background]="currentlyEditingMacro.foreground"
                   [value]="currentlyEditingMacro.foreground"/>
          </div>
          <div class="col-3 text-right font-weight-bold">BG Color</div>
          <div class="col-3">
            <input class="form-control"
                   cpPosition="bottom"
                   cpAlphaChannel="disabled"
                   [(colorPicker)]="currentlyEditingMacro.background"
                   [style.background]="currentlyEditingMacro.background"
                   [value]="currentlyEditingMacro.background"/>
          </div>
        </div>

        <div class="row">
          <div class="col-6 ml-auto">
            <div class="row p-0">
              <div class="col-3">
                <button class="btn btn-info btn-sm" (click)="changePage(currentIconPage-1)">&lt;</button>
              </div>
              <div class="col-6 text-center">Page {{ currentIconPage+1 }}</div>
              <div class="col-3 text-right">
                <button class="btn btn-info btn-sm" (click)="changePage(currentIconPage+1)">&gt;</button>
              </div>
            </div>
            <div class="d-flex flex-wrap flex-row">
              <app-icon *ngFor="let icon of currentIconsInPage"
                        [name]="icon"
                        class="macro-sheet-macro"
                        [class.active-macro]="icon === currentlyEditingMacro.icon"
                        size="small"
                        (click)="currentlyEditingMacro.icon = icon"
                        [fgColor]="currentlyEditingMacro.foreground"
                        [bgColor]="currentlyEditingMacro.background"></app-icon>
            </div>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="saveMacro()">Save Macro</button>
        <button type="button" class="btn btn-secondary" (click)="viewMacro.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #macroGroups="bs-modal" tabindex="-1" (onShow)="macroGroupModalVisible = true"
     (onHide)="macroGroupModalVisible = false">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">All Macro Groups</h3>
        <button type="button" class="close pull-right" (click)="macroGroups.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body macro-list-body" *ngIf="macroService.hasLoaded && macroGroupModalVisible">

        <div class="row mb-1">
          <h4 class="text-center w-100">Active Macro Groups</h4>
        </div>

        <div class="row pb-1 activate-inner-on-hover"
             [class.mb-5]="last"
             *ngFor="let group of macroService.visibleMacroGroups; let last = last; let first = first; let index = index">

          <div class="col-3" [class.hidden]="!group">
            <div class="text-center font-weight-bold">{{ group }} (#{{ index + 1 }})</div>
            <div class="text-center show-on-hover">
              <button class="btn btn-warning btn-sm" *ngIf="!first" (click)="removeActiveGroup(index)">Remove</button>
            </div>
          </div>

          <div class="col-9 d-flex flex-row" *ngIf="group">
            <div class="macrobar-item" *ngFor="let macroIdx of macroArray">

              <app-macro
                [macroRef]="macroService.allMacroGroups[group][macroIdx]"
                disableEffects="true"
              ></app-macro>

            </div>
          </div>
        </div>

        <div class="row mb-1">
          <h4 class="text-center w-100">All Macro Groups</h4>
        </div>

        <div class="row pb-1 activate-inner-on-hover"
             [class.mb-3]="last"
             *ngFor="let group of macroService.iterableMacroGroups; let last = last">

          <div class="col-3">
            <div class="text-center font-weight-bold">{{ group.key }}</div>
            <div class="text-center show-on-hover">
              <button class="btn btn-primary btn-sm" (click)="makeActiveGroup(group.key, 0)">1</button>
              <button class="btn btn-primary btn-sm" (click)="makeActiveGroup(group.key, 1)">2</button>
              <button class="btn btn-primary btn-sm" (click)="makeActiveGroup(group.key, 2)">3</button>
              <button class="btn btn-danger btn-sm" *ngIf="group.key !== 'default'" (click)="deleteGroup(group.key)">
                Delete
              </button>
            </div>
          </div>

          <div class="col-9 d-flex flex-row">
            <div class="macrobar-item" *ngFor="let macroIdx of macroArray">

              <app-macro
                (click)="resetVariablesForMacroPopover(group.key, macroIdx)"
                [popover]="macroSelectorPopover"
                container="body"
                containerClass="macro-popover"
                outsideClick="true"
                [triggers]="group.key === 'default' ? '' : 'click'"
                [macroRef]="macroService.allMacroGroups[group.key][macroIdx]"
                disableEffects="true"
              ></app-macro>

            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="addMacroGroup()">New Macro Group</button>
          <button type="button" class="btn btn-secondary" (click)="macroGroups.hide()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #macroSelectorPopover>

  <div class="row px-1 mb-2">
    <div class="col-3">
      <button class="btn btn-info btn-sm" (click)="changeMacroPage(currentMacroPage-1)">&lt;</button>
    </div>
    <div class="col-6 text-center">Page {{ currentMacroPage+1 }}</div>
    <div class="col-3 text-right">
      <button class="btn btn-info btn-sm" (click)="changeMacroPage(currentMacroPage+1)">&gt;</button>
    </div>
  </div>

  <div class="d-flex flex-wrap flex-row">

    <app-icon *ngFor="let macro of currentMacrosInPage"
              class="m-1"
              [name]="macroService.allMacros[macro].icon"
              [bgColor]="macroService.allMacros[macro].background || '#ccc'"
              [fgColor]="macroService.allMacros[macro].foreground"
              [tooltip]="macroService.allMacros[macro].name"
              (click)="selectMacroForSpot(macro)"
              size="nsmall"></app-icon>
  </div>

</ng-template>

<img *ngFor="let asset of preloadImageAssets" class="hidden" [src]="'assets/' + asset + '.png'" (load)="imageLoaded()" />

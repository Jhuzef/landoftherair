<app-navbar [myAccount]="myAccount"
            [gameSettings]="gameSettings"
            [silverModal]="silverModal"
            [options]="options"
            [debugOptions]="debugOptions"
            [macros]="macros"
            [macroGroups]="macroGroups"
            [aboutModal]="aboutModal"
            (openWindow)="menuOpenWindow($event)"
            (cleanup)="cleanupWindows()"
></app-navbar>

<div class="body-container">

  <div *ngIf="!colyseus.isConnected && colyseus.isConnecting" class="m-5 d-flex justify-content-center align-content-center h-100">
    <div class="alert alert-info connection-warning">
      Connecting to server...
    </div>
  </div>

  <div *ngIf="!colyseus.isConnected && !colyseus.isConnecting" class="m-5 d-flex justify-content-center align-content-center h-100">
    <div class="alert alert-warning connection-warning">
      The game client could not connect to the server. The game may be down for maintenance. Refresh the page to attempt to reconnect.
    </div>
  </div>

  <!-- LOBBY WINDOWS -->
  <app-window windowName="characterSelect"
              [hidden]="!loggedIn || inGame || !colyseus.username || !colyseus.isConnected"
              [headTemplate]="charSelectHead"
              [bodyTemplate]="charSelectBody"
  ></app-window>

  <ng-template #charSelectHead>
    Character Select
  </ng-template>

  <ng-template #charSelectBody>
    <app-character-select [resourcesLoaded]="resourcesLoaded"></app-character-select>
  </ng-template>

  <app-window windowName="lobby"
              otherWindowClasses="game-window"
              (active)="setActiveWindow($event)"
              [hidden]="!loggedIn || !colyseus.username || !colyseus.isConnected || (inGame && autoHideLobby)"
              [canMinimize]="true"
              (minimize)="minimize($event)"
              [minimized]="minimized.lobby"
              [headTemplate]="lobbyHead"
              [bodyTemplate]="lobbyBody"
  ></app-window>

  <ng-template #lobbyHead>
    Lobby Chat ({{ colyseus.lobby.lobbyState.accounts.length }} Online<span *ngIf="colyseus.isDiscordConnected"> - Discord Connected</span>)
    <em *ngIf="newMessages > 0"> *{{ newMessages }} new message<span *ngIf="newMessages > 1">s</span>!</em>
  </ng-template>

  <ng-template #lobbyBody>
    <app-lobby></app-lobby>
  </ng-template>

  <!-- GAME WINDOWS -->
  <app-window *ngIf="inGame && colyseus.game.character"
              windowName="map"
              (active)="setActiveWindow($event)"
              [canClose]="colyseus.game.clientGameState.hasLoadedInGame"
              (close)="colyseus.game.quit()"
              [headTemplate]="mapHead"
              [bodyTemplate]="mapBody"
  ></app-window>

  <ng-template #mapHead>
    World
  </ng-template>

  <ng-template #mapBody>
    <app-active-target *ngIf="showActiveTarget"></app-active-target>
    <app-map [class.hidden]="colyseus.game.isChangingMap"></app-map>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showStatsWindow"
              windowName="stats"
              otherWindowClasses="above-game-window"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showStatsWindow = false"
              [canMinimize]="true"
              (minimize)="minimize($event)"
              [minimized]="minimized.stats"
              [headTemplate]="statsHead"
              [bodyTemplate]="statsBody"
  ></app-window>

  <ng-template #statsHead>
    Stats
  </ng-template>

  <ng-template #statsBody>
    <app-stats-window [currentPlayer]="colyseus.game.character"></app-stats-window>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showSkillsWindow"
              windowName="skills"
              otherWindowClasses="above-game-window"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showSkillsWindow = false"
              [canMinimize]="true"
              (minimize)="minimize($event)"
              [minimized]="minimized.skills"
              [headTemplate]="skillsHead"
              [bodyTemplate]="skillsBody"
  ></app-window>

  <ng-template #skillsHead>
    Skills
  </ng-template>

  <ng-template #skillsBody>
    <app-skills-window [currentPlayer]="colyseus.game.character"></app-skills-window>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showTradeSkillsWindow"
              windowName="tradeSkills"
              otherWindowClasses="above-game-window"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showTradeSkillsWindow = false"
              [canMinimize]="true"
              (minimize)="minimize($event)"
              [minimized]="minimized.tradeSkills"
              [headTemplate]="tradeSkillsHead"
              [bodyTemplate]="tradeSkillsBody"
  ></app-window>

  <ng-template #tradeSkillsHead>
    Trade Skills
  </ng-template>

  <ng-template #tradeSkillsBody>
    <app-tradeskills-window [currentPlayer]="colyseus.game.character"></app-tradeskills-window>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showCommandLine"
              [class.hidden]="!showCommandLineToggle"
              windowName="commandLine"
              otherWindowClasses="above-game-window"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showCommandLine = false"
              [headTemplate]="commandLineHead"
              [bodyTemplate]="commandLineBody"
  ></app-window>

  <ng-template #commandLineHead>
    Command Line / Chat
  </ng-template>

  <ng-template #commandLineBody>
    <app-command-line [rightClickSend]="rightClickSend" (visibility)="toggleCmdVisibilityKeypress($event)"></app-command-line>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character"
              windowName="log"
              [otherWindowClasses]="'above-game-window ' + logWindowSize"
              (active)="setActiveWindow($event)"
              [headTemplate]="logHead"
              [bodyTemplate]="logBody"
  ></app-window>

  <ng-template #logHead>
    Log
  </ng-template>

  <ng-template #logBody>
    <app-log-window [windowSize]="logWindowSize"
                    [fontSize]="logFontSize"></app-log-window>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character"
              windowName="status"
              [otherWindowClasses]="'above-game-window ' + statusBarSize"
              (active)="setActiveWindow($event)"
              [canMinimize]="statusBarSize !== 'xsmall'"
              (minimize)="minimize($event)"
              [minimized]="minimized.status"
              [headTemplate]="statusHead"
              [bodyTemplate]="statusBody"
  ></app-window>

  <ng-template #statusHead>
    <app-character-tagline [player]="colyseus.game.character" [short]="statusBarSize === 'xsmall'"></app-character-tagline>
  </ng-template>

  <ng-template #statusBody>
    <app-status-window [size]="statusBarSize"></app-status-window>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showGround"
              windowName="ground"
              [otherWindowClasses]="'game-window ' + groundSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showGround = false"
              [headTemplate]="groundHead"
              [bodyTemplate]="groundBody"
  ></app-window>

  <ng-template #groundHead>
    Ground
  </ng-template>

  <ng-template #groundBody>
    <app-ground [size]="groundSize"></app-ground>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showInventorySack"
              windowName="sack"
              [otherWindowClasses]="'game-window ' + sackSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showInventorySack = false"
              [headTemplate]="sackHead"
              [bodyTemplate]="sackBody"
  ></app-window>

  <ng-template #sackHead>
    Inventory - Sack
  </ng-template>

  <ng-template #sackBody>
    <app-inventory-sack [size]="sackSize"></app-inventory-sack>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showInventoryBelt"
              windowName="belt"
              [otherWindowClasses]="'game-window ' + beltSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showInventoryBelt = false"
              [headTemplate]="beltHead"
              [bodyTemplate]="beltBody"
  ></app-window>

  <ng-template #beltHead>
    Inventory - Belt
  </ng-template>

  <ng-template #beltBody>
    <app-inventory-belt [size]="beltSize"></app-inventory-belt>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showInventoryPouch && hasPouch"
              windowName="pouch"
              [otherWindowClasses]="'game-window ' + pouchSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showInventoryPouch = false"
              [headTemplate]="pouchHead"
              [bodyTemplate]="pouchBody"
  ></app-window>

  <ng-template #pouchHead>
    Inventory - Demi-Magic Pouch
  </ng-template>

  <ng-template #pouchBody>
    <app-inventory-pouch [size]="pouchSize"></app-inventory-pouch>
  </ng-template>

  <app-window *ngIf="inGame && showEquipment"
              windowName="equipment"
              [otherWindowClasses]="'game-window ' + equipmentSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showEquipment = false"
              [headTemplate]="equipmentHead"
              [bodyTemplate]="equipmentBody"
  ></app-window>

  <ng-template #equipmentHead>
    Equipment
  </ng-template>

  <ng-template #equipmentBody>
    <app-equipment [player]="colyseus.game.character" [size]="equipmentSize"></app-equipment>
  </ng-template>

  <app-window *ngIf="inGame && showEquipmentQuick"
              windowName="equipmentQuick"
              [otherWindowClasses]="'game-window ' + equipmentSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showEquipmentQuick = false"
              [headTemplate]="equipmentQuickHead"
              [bodyTemplate]="equipmentQuickBody"
  ></app-window>

  <ng-template #equipmentQuickHead>
    Equipment (Hands)
  </ng-template>

  <ng-template #equipmentQuickBody>
    <app-equipment-quick [player]="colyseus.game.character" [size]="equipmentSize"></app-equipment-quick>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.currentViewTarget"
              windowName="equipmentViewOnly"
              [otherWindowClasses]="'game-window ' + equipmentSize"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.currentViewTarget = null"
              [headTemplate]="equipmentViewOnlyHead"
              [bodyTemplate]="equipmentViewOnlyBody"
  ></app-window>

  <ng-template #equipmentViewOnlyHead>
    {{ colyseus.game.currentViewTarget ? colyseus.game.currentViewTarget.name : 'Loading' }}'s Equipment
  </ng-template>

  <ng-template #equipmentViewOnlyBody>
    <app-equipment-viewonly *ngIf="colyseus.game.currentViewTarget" [player]="colyseus.game.currentViewTarget" [size]="equipmentSize"></app-equipment-viewonly>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character"
              windowName="npcs"
              [otherWindowClasses]="'game-window ' + npcWindowSize"
              (active)="setActiveWindow($event)"
              [headTemplate]="npcsHead"
              [bodyTemplate]="npcsBody"
  ></app-window>

  <ng-template #npcsHead>
    Characters <span *ngIf="npcWindowSize !== 'xsmall'">In View</span>
  </ng-template>

  <ng-template #npcsBody>
    <app-npcs [windowSize]="npcWindowSize"></app-npcs>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character"
              windowName="macros"
              [otherWindowClasses]="'game-window ' + macroBarSize"
              (active)="setActiveWindow($event)"
              [headTemplate]="macrosHead"
              [bodyTemplate]="macrosBody"
  ></app-window>

  <ng-template #macrosHead>
    Macros
  </ng-template>

  <ng-template #macrosBody>
    <app-macro-bars [size]="macroBarSize"></app-macro-bars>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showTrainer.uuid"
              windowName="trainer"
              [otherWindowClasses]="'above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showTrainer = {}"
              [headTemplate]="trainerHead"
              [bodyTemplate]="trainerBody"
  ></app-window>

  <ng-template #trainerHead>
    {{ colyseus.game.showTrainer.classTrain === 'Undecided' ? 'Tradeskill' : colyseus.game.showTrainer.classTrain }} Guide
  </ng-template>

  <ng-template #trainerBody>
    <app-trainer></app-trainer>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showShop.uuid"
              windowName="shop"
              [otherWindowClasses]="'above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showShop = {}"
              [headTemplate]="shopHead"
              [bodyTemplate]="shopBody"
  ></app-window>

  <ng-template #shopHead>
    Shop
  </ng-template>

  <ng-template #shopBody>
    <app-shop></app-shop>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showBank.uuid"
              windowName="bank"
              [otherWindowClasses]="'above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showBank = {}"
              [headTemplate]="bankHead"
              [bodyTemplate]="bankBody"
  ></app-window>

  <ng-template #bankHead>
    {{ colyseus.game.showBank.bankId }} Bank
  </ng-template>

  <ng-template #bankBody>
    <app-bank></app-bank>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showLocker.length > 0"
              windowName="locker"
              [otherWindowClasses]="'above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showLocker = []"
              [headTemplate]="lockerHead"
              [bodyTemplate]="lockerBody"
  ></app-window>

  <ng-template #lockerHead>
    {{ colyseus.game.activeLockerNumber ? colyseus.game.showLocker[colyseus.game.activeLockerNumber].regionId : 'Global' }} Region Wardrobe
  </ng-template>

  <ng-template #lockerBody>
    <app-lockers></app-lockers>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showParty"
              windowName="party"
              [otherWindowClasses]="'above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showParty = false"
              [headTemplate]="partyHead"
              [bodyTemplate]="partyBody"
  ></app-window>

  <ng-template #partyHead>
    Party: {{ colyseus.game.character && colyseus.game.character.partyName ? colyseus.game.character.partyName : '(no party)' }}
  </ng-template>

  <ng-template #partyBody>
    <app-party></app-party>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && showTraits"
              windowName="traits"
              [otherWindowClasses]="'above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showTraits = false"
              [headTemplate]="traitsHead"
              [bodyTemplate]="traitsBody"
  ></app-window>

  <ng-template #traitsHead>
    Traits
    (
    {{ (colyseus.game.skillTree$ | async).traitPoints || 0 }} TP
    / {{ (colyseus.game.skillTree$ | async).partyPoints || 0 }} PP
    / {{ (colyseus.game.skillTree$ | async).resetPoints || 0 }} RP
    <span *ngIf="(colyseus.game.skillTree$ | async).totalAncientPoints">/ {{ (colyseus.game.skillTree$ | async).ancientPoints || 0 }} AP</span>
    )
  </ng-template>

  <ng-template #traitsBody>
    <app-traits></app-traits>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showAlchemy.uuid"
              windowName="tradeskillAlchemy"
              [otherWindowClasses]="'tradeskill alchemy above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showAlchemy = {}"
              [headTemplate]="tradeskillAlchemyHead"
              [bodyTemplate]="tradeskillAlchemyBody"
  ></app-window>

  <ng-template #tradeskillAlchemyHead>
    Tradeskill - Alchemy
  </ng-template>

  <ng-template #tradeskillAlchemyBody>
    <app-tradeskill-alchemy></app-tradeskill-alchemy>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showSpellforging.uuid"
              windowName="tradeskillSpellforging"
              [otherWindowClasses]="'tradeskill spellforging above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showSpellforging = {}"
              [headTemplate]="tradeskillSpellforgingHead"
              [bodyTemplate]="tradeskillSpellforgingBody"
  ></app-window>

  <ng-template #tradeskillSpellforgingHead>
    Tradeskill - Spellforging
  </ng-template>

  <ng-template #tradeskillSpellforgingBody>
    <app-tradeskill-spellforging></app-tradeskill-spellforging>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showMetalworking.uuid"
              windowName="tradeskillMetalworking"
              [otherWindowClasses]="'tradeskill metalworking above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showMetalworking = {}"
              [headTemplate]="tradeskillMetalworkingHead"
              [bodyTemplate]="tradeskillMetalworkingBody"
  ></app-window>

  <ng-template #tradeskillMetalworkingHead>
    Tradeskill - Metalworking
  </ng-template>

  <ng-template #tradeskillMetalworkingBody>
    <app-tradeskill-metalworking></app-tradeskill-metalworking>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.showMarketBoard.uuid"
              windowName="marketboard"
              [otherWindowClasses]="'marketboard above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="colyseus.game.showMarketBoard = {}"
              [headTemplate]="marketboardHead"
              [bodyTemplate]="marketboardBody"
  ></app-window>

  <ng-template #marketboardHead>
    Market Board
  </ng-template>

  <ng-template #marketboardBody>
    <app-market-board></app-market-board>
  </ng-template>

  <app-window *ngIf="inGame && colyseus.game.character && colyseus.game.character.rightHand && colyseus.game.character.rightHand.bookPages"
              windowName="book"
              [otherWindowClasses]="'book above-game-window'"
              (active)="setActiveWindow($event)"
              [canClose]="false"
              [headTemplate]="bookHead"
              [bodyTemplate]="bookBody"
  ></app-window>

  <ng-template #bookHead>
    Reading Book
  </ng-template>

  <ng-template #bookBody>
    <app-book [book]="colyseus.game.character.rightHand"></app-book>
  </ng-template>

  <app-window *ngIf="showJournal"
              windowName="journal"
              [otherWindowClasses]="'journal above-game-window'"
              [hidden]="!loggedIn"
              (active)="setActiveWindow($event)"
              [canClose]="true"
              (close)="showJournal = false"
              [headTemplate]="journalHead"
              [bodyTemplate]="journalBody"
  ></app-window>

  <ng-template #journalHead>
    Journal
  </ng-template>

  <ng-template #journalBody>
    <app-journal></app-journal>
  </ng-template>

</div>

<div class="modal fade" bsModal #options="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title pull-left">Options</h3>
        <button type="button" class="close pull-right" (click)="options.hide()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="options.isShown">

        <tabset>

          <tab heading="UI Window Sizes">
            <div class="row mb-1 mt-2">
              <div class="col-3 text-right font-weight-bold">Sack Icons</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Belt Icons</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1" *ngIf="hasPouch">
              <div class="col-3 text-right font-weight-bold">Pouch Icons</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="pouchSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="pouchSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="pouchSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Equipment Icons</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Ground Icons</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Log Font Size</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="xlarge">Gigantic</label>
                  <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="large">Large</label>
                  <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Macro Bar Size</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="macroBarSize" btnRadio="normal">Normal</label>
                  <label class="btn btn-info" [(ngModel)]="macroBarSize" btnRadio="small">Small</label>
                  <label class="btn btn-info" [(ngModel)]="macroBarSize" btnRadio="xsmall">Miniature</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Status Bar Size</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="statusBarSize" btnRadio="normal">Two Lines</label>
                  <label class="btn btn-info" [(ngModel)]="statusBarSize" btnRadio="small">One Line</label>
                  <label class="btn btn-info" [(ngModel)]="statusBarSize" btnRadio="xsmall">Vertical</label>
                </div>
              </div>
            </div>

            <div class="row mb-1">
              <div class="col-3 text-right font-weight-bold">Character Window Size</div>
              <div class="col">
                <div class="btn-group">
                  <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="normal">Three Columns</label>
                  <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="small">Two Columns</label>
                  <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="xsmall">One Column</label>
                </div>
              </div>
            </div>
          </tab>

          <tab heading="UI Options">

            <div class="row mt-2">
              <div class="col-3 text-right font-weight-bold">Theme</div>
              <div class="col form-check">
                <select class="form-control" [(ngModel)]="theme">
                  <option [value]="'Light'">Light</option>
                  <option [value]="'Dark'">Dark</option>
                </select>
              </div>
            </div>

            <div class="row mt-3">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="rightClickSend">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="rightClickSend" id="rightClickSend"/>
                  Right-click to send command line
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="autoAttack">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="autoAttack" id="autoAttack"/>
                  Auto-attack while there is an active target
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="autoHideLobby">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="autoHideLobby" id="autoHideLobby"/>
                  Hide lobby while game is open
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="lockWindowPositions">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="lockWindowPositions" id="lockWindowPositions"/>
                  Lock All Window Positions
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="noFantasy">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="noFantasy" id="noFantasy"/>
                  Turn Off Fantasy Font
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="suppressZeroDamage">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="suppressZeroDamage" id="suppressZeroDamage"/>
                  Suppress 0-damage messages
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="suppressOutgoingDot">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="suppressOutgoingDot" id="suppressOutgoingDot"/>
                  Suppress outgoing DoT damage
                </label>
              </div>
            </div>


            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="suppressAnimations">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="suppressAnimations" id="suppressAnimations"/>
                  Stop Item Animations
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="enterToggleCommand">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="enterToggleCommand" id="enterToggleCommand"/>
                  Use Enter to toggle Command Line visibility
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="showActiveTarget">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="showActiveTarget" id="showActiveTarget"/>
                  Show Current Target Information (Ctrl-Click to select without attacking)
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="pinLastTarget">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="pinLastTarget" id="pinLastTarget"/>
                  Pin Last Target Click Position
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                Sort friendlies
                <div class="form-check form-check-inline ml-1">
                  <input type="radio" class="form-check-input" [(ngModel)]="shouldSortFriendly" [value]="null" name="shouldSortFriendly1" id="shouldSortFriendly1"/>
                  <label class="form-check-label" for="shouldSortFriendly1">none</label>
                </div>
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" [(ngModel)]="shouldSortFriendly" [value]="true" name="shouldSortFriendly2" id="shouldSortFriendly2"/>
                  <label class="form-check-label" for="shouldSortFriendly2">first</label>
                </div>
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" [(ngModel)]="shouldSortFriendly" [value]="false" name="shouldSortFriendly3" id="shouldSortFriendly3"/>
                  <label class="form-check-label" for="shouldSortFriendly3">last</label>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                Sort by distance
                <div class="form-check form-check-inline ml-1">
                  <input type="radio" class="form-check-input" [(ngModel)]="sortNPCsByDistance" [value]="null" name="sortNPCsByDistance1" id="sortNPCsByDistance1"/>
                  <label class="form-check-label" for="sortNPCsByDistance1">none</label>
                </div>
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" [(ngModel)]="sortNPCsByDistance" [value]="true" name="sortNPCsByDistance2" id="sortNPCsByDistance2" />
                  <label class="form-check-label" for="sortNPCsByDistance2">closest</label>
                </div>
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" [(ngModel)]="sortNPCsByDistance" [value]="false" name="sortNPCsByDistance3" id="sortNPCsByDistance3"/>
                  <label class="form-check-label" for="sortNPCsByDistance3">farthest</label>
                </div>
              </div>
            </div>
          </tab>

          <tab heading="Audio Options">
            <div class="row mt-2">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="playBackgroundMusic">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="playBackgroundMusic" id="playBackgroundMusic"/>
                  Play Background Music
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="playSoundEffects">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="playSoundEffects" id="playSoundEffects"/>
                  Play Sound Effects
                </label>
              </div>
            </div>

            <div class="row">
              <div class="col-9 ml-auto form-check">
                <label class="form-check-label" for="nostalgicBackgroundMusic">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="nostalgicBackgroundMusic" id="nostalgicBackgroundMusic"/>
                  Nostalgic Noises (Background Music & Sound Effects)
                </label>
              </div>
            </div>
          </tab>

          <tab heading="Custom CSS">
            <textarea class="form-control custom-css" [(ngModel)]="customCSS" placeholder="Add custom CSS here..."></textarea>
          </tab>

        </tabset>

      </div>

      <div class="modal-footer">
        <div>
        </div>
        <div>
          <button type="button" class="btn btn-secondary ml-1" (click)="options.hide()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #macros="bs-modal" tabindex="-1" (onShow)="showMacroModal()">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">All Macros</h3>
        <button type="button" class="close pull-right" (click)="macros.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body macro-list-body" *ngIf="macroService.hasLoaded && macros.isShown">
        <div class="row mb-1 activate-inner-on-hover" *ngFor="let macro of macroService.allMacroNames()">
          <div class="col-2" *ngIf="macroService.allMacros[macro]">
            <app-icon [name]="macroService.allMacros[macro].icon"
                      [bgColor]="macroService.allMacros[macro].background || '#ccc'"
                      [fgColor]="macroService.allMacros[macro].foreground"
                      size="small"></app-icon>
          </div>
          <div class="col-6" *ngIf="macroService.allMacros[macro]">
            {{ fixMacroName(macro) }}
          </div>
          <div class="col-4" *ngIf="macroService.allMacros[macro]">
            <div class="show-on-hover">
              <button class="btn btn-info btn-sm"
                      *ngIf="!macroService.allMacros[macro].isSystem" (click)="editMacro(macroService.allMacros[macro])">
                Edit
              </button>
              <button class="btn btn-info btn-sm"
                      *ngIf="macroService.allMacros[macro].isSystem" (click)="copyMacro(macroService.allMacros[macro])">
                Copy
              </button>
              <button class="btn btn-danger btn-sm ml-1"
                      *ngIf="!macroService.allMacros[macro].isSystem"
                      (click)="deleteMacro(macroService.allMacros[macro])">Remove
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div>
          <button type="button" class="btn btn-info" (click)="macros.hide(); macroGroups.show()">To Macro Groups</button>
        </div>
        <div>
          <button type="button" class="btn btn-primary" (click)="addMacro()">New Macro</button>
          <button type="button" class="btn btn-secondary ml-1" (click)="macros.hide()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #viewMacro="bs-modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Edit Macro</h3>
        <button type="button" class="close pull-right" (click)="viewMacro.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="viewMacro.isShown">

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Name</div>
          <div class="col-9">
            <input class="form-control" [(ngModel)]="currentlyEditingMacro.name" placeholder="Enter your macro name"/>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Macro</div>
          <div class="col-9">
            <textarea class="form-control" rows="3" [(ngModel)]="currentlyEditingMacro.macro"
                      placeholder="Enter your macro command. Separate multiple commands with semicolons"></textarea>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Key</div>
          <div class="col-3">
            <input class="form-control" [(ngModel)]="currentlyEditingMacro.key" (keydown)="setMacroKey($event)"
                   placeholder="Press Key"/>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.shift"
                    [class.btn-success]="currentlyEditingMacro.modifiers.shift"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.shift">Shift
            </button>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.ctrl"
                    [class.btn-success]="currentlyEditingMacro.modifiers.ctrl"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.ctrl">Ctrl
            </button>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.alt"
                    [class.btn-success]="currentlyEditingMacro.modifiers.alt"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.alt">Alt
            </button>
          </div>
        </div>

        <div class="row mb-1" *ngIf="isInvalidMacroCombination">
          <div class="col-3"></div>
          <div class="col-9 font-italic text-danger small-text">This macro combination may not work if you're in a web browser!</div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Mode</div>
          <div class="col-9">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.clickToTarget"
                    [class.btn-success]="currentlyEditingMacro.clickToTarget"
                    (click)="changeMacroMode('clickToTarget')"
                    tooltip="Clicking this macro will let you click an NPC target"
            >Need Target
            </button>
            <button class="btn ml-1"
                    [class.btn-secondary]="!currentlyEditingMacro.autoActivate"
                    [class.btn-success]="currentlyEditingMacro.autoActivate"
                    (click)="changeMacroMode('autoActivate')"
                    tooltip="Clicking this macro will fire it instantly"
            >Instant
            </button>
            <button class="btn ml-1"
                    [class.btn-secondary]="!currentlyEditingMacro.lockActivation"
                    [class.btn-success]="currentlyEditingMacro.lockActivation"
                    (click)="changeMacroMode('lockActivation')"
                    tooltip="Clicking this macro will make it your default click action (similar to Attack)"
            >Locked
            </button>
          </div>
        </div>

        <div class="row mb-1" *ngIf="currentlyEditingMacro.lockActivation">
          <div class="col-3"></div>
          <div class="col-9">
            <label class="form-check-label" for="macroLockActivationIgnore">
              <input type="checkbox" class="form-check-input" [(ngModel)]="currentlyEditingMacro.ignoreAutoattackOption" id="macroLockActivationIgnore"/>
              Ignore Auto-attack For This Macro
            </label>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">FG Color</div>
          <div class="col-3">
            <input class="form-control"
                   cpPosition="bottom"
                   cpAlphaChannel="disabled"
                   [(colorPicker)]="currentlyEditingMacro.foreground"
                   [style.background]="currentlyEditingMacro.foreground"
                   [value]="currentlyEditingMacro.foreground"/>
          </div>
          <div class="col-3 text-right font-weight-bold">BG Color</div>
          <div class="col-3">
            <input class="form-control"
                   cpPosition="bottom"
                   cpAlphaChannel="disabled"
                   [(colorPicker)]="currentlyEditingMacro.background"
                   [style.background]="currentlyEditingMacro.background"
                   [value]="currentlyEditingMacro.background"/>
          </div>
        </div>

        <div class="row">
          <div class="col-6 ml-auto">
            <div class="row p-0">
              <div class="col-3">
                <button class="btn btn-info btn-sm" (click)="changePage(currentIconPage-1)">&lt;</button>
              </div>
              <div class="col-6 text-center">Page {{ currentIconPage+1 }}</div>
              <div class="col-3 text-right">
                <button class="btn btn-info btn-sm" (click)="changePage(currentIconPage+1)">&gt;</button>
              </div>
            </div>
            <div class="d-flex flex-wrap flex-row">
              <app-icon *ngFor="let icon of currentIconsInPage"
                        [name]="icon"
                        class="macro-sheet-macro"
                        [class.active-macro]="icon === currentlyEditingMacro.icon"
                        size="small"
                        (click)="currentlyEditingMacro.icon = icon"
                        [fgColor]="currentlyEditingMacro.foreground"
                        [bgColor]="currentlyEditingMacro.background"></app-icon>
            </div>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <div></div>
        <div>
          <button type="button" class="btn btn-primary" [disabled]="invalidMacro()" (click)="saveMacro()">Save Macro</button>
          <button type="button" class="btn btn-secondary ml-1" (click)="viewMacro.hide()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #macroGroups="bs-modal" tabindex="-1" (onShow)="showMacroModal()">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">All Macro Groups</h3>
        <button type="button" class="close pull-right" (click)="macroGroups.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body macro-list-body" *ngIf="macroService.hasLoaded && macroGroups.isShown">

        <!--
        <div class="row mb-1">
          <h4 class="text-center w-100">Active Macro Groups</h4>
        </div>

        <div class="row pb-1 activate-inner-on-hover"
             [class.mb-5]="last"
             *ngFor="let group of macroService.visibleMacroGroups; let last = last; let first = first; let index = index">

          <div class="col-3" [class.hidden]="!group">
            <div class="text-center font-weight-bold">{{ group }} (#{{ index + 1 }})</div>
            <div class="text-center show-on-hover">
              <button class="btn btn-warning btn-sm" *ngIf="!first" (click)="removeActiveGroup(index)">Remove</button>
            </div>
          </div>

          <div class="col-9 d-flex flex-row" *ngIf="group">
            <div class="macrobar-item" *ngFor="let macroIdx of macroArray">

              <app-macro
                [macroRef]="macroService.allMacroGroups[group][macroIdx]"
                disableEffects="true"
              ></app-macro>

            </div>
          </div>
        </div>
        -->

        <div class="row mb-1">
          <h6 class="text-center w-100 font-italic">(left click to select new macro, right click to remove macro)</h6>
        </div>

        <div class="row pb-1 activate-inner-on-hover"
             [class.mb-3]="last"
             *ngFor="let group of macroService.iterableMacroGroups; let first = first; let last = last">

          <div class="col-3">
            <div class="text-center font-weight-bold">
              {{ group.key }}
              <span *ngIf="isMacroGroupActive(group.key)">(#{{ isMacroGroupActive(group.key) }})</span>
            </div>
            <div class="text-center show-on-hover">
              <button class="btn btn-warning ml-1 btn-sm btn-short"
                      *ngIf="!first && isMacroGroupActive(group.key) && isMacroGroupActive(group.key) !== 1"
                      (click)="removeActiveGroup(isMacroGroupActive(group.key) - 1)">Remove</button>

              <button class="btn btn-primary ml-1 btn-sm btn-short" *ngIf="!isMacroGroupActive(group.key)" (click)="makeActiveGroup(group.key, 0)">1</button>
              <button class="btn btn-primary ml-1 btn-sm btn-short" *ngIf="!isMacroGroupActive(group.key)" (click)="makeActiveGroup(group.key, 1)">2</button>
              <button class="btn btn-primary ml-1 btn-sm btn-short" *ngIf="!isMacroGroupActive(group.key)" (click)="makeActiveGroup(group.key, 2)">3</button>

              <button class="btn btn-warning ml-1 btn-sm btn-short"
                      *ngIf="!isMacroGroupActive(group.key) && group.key === 'default'"
                      (click)="resetDefaultGroup()">Reset</button>

              <button class="btn btn-danger ml-1 btn-sm btn-short"
                      *ngIf="!isMacroGroupActive(group.key) && group.key !== 'default'"
                      (click)="deleteGroup(group.key)">Delete</button>
            </div>
          </div>

          <div class="col-9 d-flex flex-row">
            <div class="macrobar-item" *ngFor="let macroIdx of macroArray">

              <app-macro
                (click)="resetVariablesForMacroPopover(group.key, macroIdx)"
                (contextmenu)="unsetMacro(group.key, macroIdx)"
                [popover]="macroSelectorPopover"
                container="body"
                containerClass="macro-popover"
                outsideClick="true"
                placement="bottom"
                [triggers]="'click'"
                [macroRef]="macroService.allMacroGroups[group.key][macroIdx]"
                disableEffects="true"
              ></app-macro>

            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div>
            <button type="button" class="btn btn-info" (click)="macroGroups.hide(); macros.show()">To Macros</button>
          </div>
          <div>
            <button type="button" class="btn btn-warning" (click)="macroService.exportMacros()">Export Macros</button>
            <input type="file" #uploadMacros class="hidden" accept=".json" (change)="macroService.importMacros($event, uploadMacros)"/>
            <button type="button" class="btn btn-warning ml-1" (click)="uploadMacros.click()">Import Macros</button>
          </div>
          <div>
            <button type="button" class="btn btn-primary" (click)="addMacroGroup()">New Macro Group</button>
            <button type="button" class="btn btn-secondary ml-1" (click)="macroGroups.hide()">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #debugOptions="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Debug Options</h3>
        <button type="button" class="close pull-right" (click)="debugOptions.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="debugOptions.isShown">
        <strong>Be careful, modifying these settings can break or slow down your game.</strong>

        <div class="row mt-3">
          <div class="col text-center"><h4>Debug Toggles</h4></div>
        </div>

        <div class="row mt-3">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="colyseusDebug">
              <input type="checkbox" class="form-check-input" [(ngModel)]="colyseusDebug" id="colyseusDebug"/>
              Colyseus Debug
            </label>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col text-center"><h4>Spritesheet Options</h4></div>
        </div>

        <div class="row px-3 mt-3" *ngFor="let key of assetService.customKeys">
          <h6>{{ key }} url</h6>
          <input type="text"
                 class="form-control"
                 [placeholder]="assetService[key + 'Url']"
                 [(ngModel)]="assetService.customURLs[key]"
                 (change)="assetService.updateURLs()" />
        </div>
      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-warning" (click)="applyDebug()">Apply</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #aboutModal="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">About Land of the Rair</h3>
        <button type="button" class="close pull-right" (click)="aboutModal.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="aboutModal.isShown">

        <div class="row">
          <div class="col">
            <h5>License</h5> Land of the Rair is <a href="https://github.com/LandOfTheRair/landoftherair/blob/master/LICENSE" target="_blank">GPL-3.0 licensed</a>, but is <a href="https://github.com/LandOfTheRair/landoftherair" target="_blank">entirely open source</a>.
          </div>
        </div>

        <div class="row mt-3">
          <div class="col">
            <h5>Version Notes/Changelog</h5> For version notes, you can check the <a href="https://github.com/LandOfTheRair/landoftherair/blob/master/CHANGELOG.md" target="_blank">changelog</a>. While this changelog encompasses most changes, fixes, and enhancements, periods of frequent balancing are often not tracked.
          </div>
        </div>

        <div class="row mt-3">
          <div class="col">
            <h5>Credits</h5> For a running list of credits regarding major libraries used, art, music, and player created content, <a href="https://rair.land/docs/credits/" target="_blank">please see the credits page on rair.land.</a>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col">
            <h5>Current Version</h5> {{ gitVersion }}
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-default" (click)="aboutModal.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #silverModal="bs-modal" tabindex="-1" (onShow)="updateAccount()">
  <div class="modal-dialog modal-lg silver-modal">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Buy and Spend Silver</h3>
        <button type="button" class="close pull-right" (click)="silverModal.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="silverModal.isShown">

        <div class="top-container">
          <img src="https://rair.land/img/coin.png" width="64" height="64" /> You have {{ (colyseus.lobby.myAccount.silver || 0) | number }} silver.
        </div>

        <tabset justified="true">
          <tab heading="Buy Silver">

            <div class="row mt-3">
              <div class="col-md-1"></div>
              <div class="text-center col-md-10">
                <div class="alert alert-info">
                  <strong>Hey, {{ colyseus.lobby.myAccount.username }}!</strong> Your purchases here are not treated as profits. All money earned goes back into making the game more sustainable, as well as paying for any help the dev team receives. This includes things like beefier servers, more resilient databases, and any royalties incurred. <strong>When making a payment, please wait for the popup AFTER the payment popup to confirm your payment!</strong>
                </div>
              </div>
              <div class="col-md-1"></div>
            </div>

            <div class="row mt-3">
              <div class="col-md-6">
                <h4 class="text-center">Just Silver</h4>

                <p class="text-center">These are just one-time payments to get some silver. You can see the silver cost of what you want in the "Spend Silver" tab.</p>

                <div *ngFor="let pricePoint of colyseus.lobby.lobbyState.silverPrices.micro" class="mt-3 row">
                  <div class="col-md-2 text-right">
                    <img src="https://rair.land/img/coin.png" width="64" height="64" />
                  </div>
                  <div class="col-md-10 d-flex justify-content-center align-items-center">
                    <button class="btn btn-primary btn-block" (click)="startPayment(pricePoint)" [disabled]="!stripeCheckoutHandler">
                      Buy {{ pricePoint.silver | number }} silver for {{ pricePoint.price / 100 | number }}
                      <span *ngIf="pricePoint.percentOverAverage">(+{{ pricePoint.percentOverAverage }}% more!)</span>
                    </button>
                  </div>
                </div>

              </div>

              <div class="col-md-6">
                <h4 class="text-center">Subscribe</h4>

                <div class="text-center mt-3">
                  <a href="http://rair.land/docs/subscriber-benefits/" target="_blank">Click this link to see all the awesome perks of subscribing!</a>
                </div>

                <div class="mt-3 text-center" *ngIf="colyseus.lobby.myAccount.subscriptionTier > 1">
                  You have an active subscription that will end on {{ colyseus.lobby.myAccount.trialEnds | date:'medium' }}! Thanks! You can add more months to your subscription below if you're interested.
                </div>

                <div class="text-center mt-3" *ngIf="colyseus.lobby.myAccount.subscriptionTier <= 1">If you're interested in trying before buying, contact a GM to set up a trial subscription. The trial will last 30 days, but you can always go back to playing for free.</div>

                <div class="mt-3">

                  <div *ngFor="let pricePoint of colyseus.lobby.lobbyState.silverPrices.sub" class="mt-3">
                    <button class="btn btn-success btn-block"
                            (click)="startPayment(pricePoint)"
                            [disabled]="!stripeCheckoutHandler"
                            [class.btn-info]="colyseus.lobby.myAccount.subscriptionTier > 1">
                      Subscribe for {{ pricePoint.duration }} month(s) for {{ pricePoint.price / 100 | number }}
                      <span *ngIf="pricePoint.percentOverAverage">({{ pricePoint.percentOverAverage }} free months!)</span>
                    </button>
                  </div>

                </div>
              </div>
            </div>

          </tab>

          <tab heading="Spend Silver">

            <div class="row mt-3" *ngFor="let purchaseItem of colyseus.lobby.lobbyState.silverPurchases">
              <div class="col-md-1">
                <div class="icon-container">
                  <app-icon [name]="purchaseItem.icon" [fgColor]="purchaseItem.fgColor"></app-icon>
                </div>
              </div>

              <div class="col-md-8">
                <div><strong>{{ purchaseItem.name }}</strong> ({{ getNumSilverItemPurchased(purchaseItem.key) }}/{{ purchaseItem.maxPurchases }})</div>
                <div>{{ purchaseItem.desc }}</div>
              </div>

              <div class="col-md-3">
                <button class="btn btn-primary btn-block"
                        (click)="doItemPurchase(purchaseItem)"
                        [disabled]="unableToPurchase(purchaseItem)">
                  Purchase for {{ purchaseItem.cost | number }} silver
                </button>
              </div>
            </div>

          </tab>
        </tabset>
      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-warning" (click)="silverModal.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #gameSettings="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Current Events</h3>
        <button type="button" class="close pull-right" (click)="gameSettings.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="gameSettings.isShown">

        <div class="row mb-3" *ngIf="currentHoliday">
          <div class="col-12 text-center">
            <h5>Holiday</h5>
            <div><strong>{{ currentHoliday.name }}</strong>: {{ currentHoliday.description }}</div>
            <div>
              <a href="https://rair.land/docs/{{ currentHoliday.name }}/" target="_blank">More Info</a>
            </div>
          </div>
        </div>

        <div class="row" *ngIf="colyseus.lobby.lobbyState.bonusInfo as bonusData">
          <div class="col-6">
            <h5>Base Multipliers</h5>
            <div>XP Multiplier: {{ bonusData.bonus.xpMult * 100 }}%</div>
            <div>Ancient XP Multiplier: {{ bonusData.bonus.axpMult * 100 }}%</div>
            <div>Gold Multiplier: {{ bonusData.bonus.goldMult * 100 }}%</div>
            <div>Skill Multiplier: {{ bonusData.bonus.skillMult * 100 }}%</div>
            <div>Item Find Multiplier: {{ bonusData.bonus.itemFindMult * 100 }}%</div>
          </div>
          <div class="col-6">
            <h5>Bonus Festivals</h5>
            <div *ngIf="bonusData.bonusHours.xpMult">+100% XP ({{ bonusData.bonusHours.xpMult }} hours)</div>
            <div *ngIf="bonusData.bonusHours.axpMult">+100% Ancient XP ({{ bonusData.bonusHours.axpMult }} hours)</div>
            <div *ngIf="bonusData.bonusHours.goldMult">+100% Gold ({{ bonusData.bonusHours.goldMult }} hours)</div>
            <div *ngIf="bonusData.bonusHours.skillMult">+100% Skill ({{ bonusData.bonusHours.skillMult }} hours)</div>
            <div *ngIf="bonusData.bonusHours.itemFindMult">+100% Item Find ({{ bonusData.bonusHours.itemFindMult }} hours)</div>

            <div *ngIf="!bonusData.bonusHours.xpMult
                     && !bonusData.bonusHours.axpMult
                     && !bonusData.bonusHours.goldMult
                     && !bonusData.bonusHours.skillMult
                     && !bonusData.bonusHours.itemFindMult">None. You should start one!</div>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-default" (click)="gameSettings.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #myAccount="bs-modal" tabindex="-1" (onShow)="updateMyServerInformation()">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">My Account</h3>
        <button type="button" class="close pull-right" (click)="myAccount.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="myAccount.isShown">
        <div class="row mt-3">
          <div class="col-4 text-right font-weight-bold">Created</div>
          <div class="col-8">{{ colyseus.lobby.myAccount.createdAt | date:'medium' }}</div>
        </div>

        <div class="row mt-3">
          <div class="col-4 text-right font-weight-bold">Email</div>
          <div class="col-8">{{ colyseus.lobby.myAccount.email }}</div>
        </div>

        <div class="row mt-3">
          <div class="col-4 text-right font-weight-bold">Discord Tag</div>
          <div class="col-8">
            <div class="input-group mb-3">
              <input class="form-control" [(ngModel)]="updateDiscordTag" placeholder="DiscordTag#0000" />
              <div class="input-group-append">
                <button class="btn btn-outline-primary no-border-radius-left" type="button" (click)="tryUpdateDiscordTag()">Update</button>
              </div>
            </div>

            <div class="row">
              <div class="col text-center">
                <h6><em><small>Adding your discord tag allows you to get roles assigned based on your subscriber status and will also automatically assign your guild role. These roles give you access to special channels in the discord!</small></em></h6>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="row mt-3" *ngIf="updateDiscordTag">
        <div class="col-4"></div>
        <div class="col-8">
          <label class="ml-3" for="alwaysOnline">
            <input type="checkbox" class="form-check-input" [(ngModel)]="updateDiscordOnline" (change)="tryUpdateDiscordOnline()" id="alwaysOnline"/>
            Always Online
          </label>

          <div class="row">
            <div class="col text-center">
              <h6><em><small>Being "Always Online" means you'll show up in lobby if you're online in discord, but not in game.</small></em></h6>
            </div>
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-default" (click)="myAccount.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<ng-template #macroSelectorPopover>

  <div class="row px-1 mb-2">
    <div class="col-3">
      <button class="btn btn-info btn-sm" (click)="changeMacroPage(currentMacroPage-1)">&lt;</button>
    </div>
    <div class="col-6 text-center">Page {{ currentMacroPage+1 }}</div>
    <div class="col-3 text-right">
      <button class="btn btn-info btn-sm" (click)="changeMacroPage(currentMacroPage+1)">&gt;</button>
    </div>
  </div>

  <div class="d-flex flex-wrap flex-row">

    <app-icon *ngFor="let macro of currentMacrosInPage"
              class="m-1"
              [name]="macroService.allMacros[macro].icon"
              [bgColor]="macroService.allMacros[macro].background || '#ccc'"
              [fgColor]="macroService.allMacros[macro].foreground"
              [tooltip]="fixMacroName(macroService.allMacros[macro].name)"
              (click)="selectMacroForSpot(macro)"
              size="nsmall"></app-icon>
  </div>

</ng-template>

<div class="bottom-subscriber-reminder" *ngIf="!colyseus.isSubscribed">
  You're not currently subscribed. Please consider <a (click)="silverModal.show()">subscribing or buying silver</a> to help keep the lights on! Want to know what you get for subscribing?
  <br>
  <a href="http://rair.land/docs/subscriber-benefits/" target="_blank">Click this link to see all the awesome perks of subscribing!</a>
</div>

<ng-walkthrough-flow #lobbyTour
                     focusBackdrop="true"
                     focusHighlightAnimation="true"
                     closeButton="true"
                     closeAnywhere="false"
                     arrowColor="#fff"
                     showArrow="true"
                     radius="5px">

  <ng-walkthrough
    [focusElementSelector]="null"
    [contentTemplate]="startLobbyFlow">
    <ng-template #startLobbyFlow>
      <h4 class="text-center">Welcome to the Lobby!</h4>
      This is a brief guided tour of the UI to get you on your way. This is very quick, please read it if you're a new user!
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#characterSelect"
    [contentTemplate]="characterSelectFlow">
    <ng-template #characterSelectFlow>
      <h4 class="text-center">Character Select</h4>
      This is the character select window. Here, you can create new characters by hitting "Create" and then joining the actual game by hitting "Play" - pretty simple!
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#lobby"
    [contentTemplate]="lobbyFlow">
    <ng-template #lobbyFlow>
      <h4 class="text-center">The Lobby Window</h4>
      This is the lobby window. You can chat with other players here. If you don't see many players online, don't worry! The game should be connected to discord, as well, so you can still get help if you're stuck.
    </ng-template>
  </ng-walkthrough>

</ng-walkthrough-flow>

<ng-walkthrough-flow #tour
                     focusBackdrop="true"
                     focusHighlightAnimation="true"
                     closeButton="true"
                     closeAnywhere="false"
                     arrowColor="#fff"
                     showArrow="true"
                     radius="5px">

  <ng-walkthrough
    [focusElementSelector]="null"
    [contentTemplate]="startFlow">
    <ng-template #startFlow>
      <h4 class="text-center">Welcome to Land of the Rair!</h4>
      This is a brief guided tour of the UI to get you on your way. You can hit the X in the top right to get right into the action.
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#map"
    [contentTemplate]="mapFlow">
    <ng-template #mapFlow>
      <h4 class="text-center">The Map</h4>
      This is the map. It's your viewport to the world, and how you move around. You can click on any tile to move towards it. You will also see where other characters are, relative to where you can see.
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#status"
    [contentTemplate]="statusFlow">
    <ng-template #statusFlow>
      <h4 class="text-center">Your Status</h4>
      This window shows your status - your health, mana (where applicable), and your current experience. If you get any buffs or debuffs, those will show up on the left side.
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#npcs"
    [contentTemplate]="npcsFlow">
    <ng-template #npcsFlow>
      <h4 class="text-center">The Character List</h4>
      This is the character list. Here, every character in your view is listed, along with what they're holding and what they're wearing, their direction from you, and a rough indicator of their health. <strong>You can click on them to interact with them!</strong> Green means they're a friendly NPC, grey means they aren't hostile, but can be attacked, and red means that they are hostile and will attack you. <strong>You can drag it vertically to resize it, too!</strong>

      <br><br>
      <strong>When you are finished with the tour, try interacting with the Greeter!</strong>
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#macros"
    [contentTemplate]="macrosFlow">
    <ng-template #macrosFlow>
      <h4 class="text-center">Macros</h4>
      This box shows your current "macro set" (basically, a set of commands). You can see that the "Attack" action is highlighted, which means any time you click on a grey NPC, you will attempt to attack it. Be careful!
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#log"
    [contentTemplate]="logFlow">
    <ng-template #logFlow>
      <h4 class="text-center">The Log</h4>
      Here you can see combat, NPC chatter, and various environment changes. As you move around, engage in combat, and talk to NPCs, more messages will appear here! <strong>You can drag it vertically to resize it, too!</strong>
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#commandLine"
    [contentTemplate]="commandLineFlow">
    <ng-template #commandLineFlow>
      <h4 class="text-center">The Command Line</h4>
      The command line is one of your primary ways to interact with the world. You can use it to run commands (macros are just commands), talk to npcs (by saying <strong>name, hello</strong> or, for example, <strong>Greeter, hello</strong>). You can also change it to "Say" or "Global" mode to talk with other players - just click the "Cmd" button!
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#equipment"
    [contentTemplate]="equipmentFlow">
    <ng-template #equipmentFlow>
      <h4 class="text-center">Equipment</h4>
      This is your equipment. You'll notice you have a weapon equipped in your right hand (your primary hand), and that you're wearing a tunic. As you travel the lands, you'll find new weapons and new pieces of gear.
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#belt"
    [contentTemplate]="beltFlow">
    <ng-template #beltFlow>
      <h4 class="text-center">Belt</h4>
      Your belt is where all of your weapons will go. For the most part, only weapons can go in here.
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#sack"
    [contentTemplate]="sackFlow">
    <ng-template #sackFlow>
      <h4 class="text-center">Sack</h4>
      Your sack is where most of your miscellaneous items go. You'll find bottles, rocks, boxes, and all sorts of things to go in here. You can also fit some small armor pieces (gloves, sashes, etc) and some small weapons (daggers, shortswords, etc) in it.
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    focusElementSelector="#windowList"
    [contentTemplate]="windowListFlow">
    <ng-template #windowListFlow>
      <h4 class="text-center">Window Menu</h4>
      Up there, there are a few more windows you can explore. For the most part, they're representations of your characters capabilities, and nothing you need to look at right away. <br>
      Also in this menu is the "Options" menu, which will let you change UI size, sound settings, and more. Take a look at that!
    </ng-template>
  </ng-walkthrough>

  <ng-walkthrough
    [contentTemplate]="endFlow">
    <ng-template #endFlow>
      <h4 class="text-center">The End!</h4>
      That's it! Go out and slay some monsters!
    </ng-template>
  </ng-walkthrough>

</ng-walkthrough-flow>

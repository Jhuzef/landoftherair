<nav class="navbar navbar-expand-lg navbar-light bg-faded">
  <a class="navbar-brand" href="#">
    <span>Land of the Rair</span>
    <span *ngIf="colyseus.lobby.myAccount.username">- {{ colyseus.lobby.myAccount.username }}</span>
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item" *ngIf="colyseus.lobby.myAccount" dropdown container="body">
        <a class="nav-link" href="#" dropdownToggle>Game {{ colyseus.isConnected ? '' : '(Disconnected)' }}</a>

        <ul *dropdownMenu class="dropdown-menu">
          <li *ngIf="!inGame">
            <a class="dropdown-item" (click)="silverModal.show()">Manage Silver</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item" (click)="colyseus.game.quit()">Quit To Lobby</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="logout()">Logout</a>
          </li>
        </ul>

      </li>
    </ul>

    <ul class="navbar-nav">
      <li class="nav-item" *ngIf="colyseus.lobby.myAccount" dropdown container="body">
        <a class="nav-link" href="#" dropdownToggle>Windows</a>

        <ul *dropdownMenu class="dropdown-menu">
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showStatsWindow = !showStatsWindow; activeWindow = 'stats'">Stats</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showSkillsWindow = !showSkillsWindow; activeWindow = 'skills'">Skills</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showTradeSkillsWindow = !showTradeSkillsWindow; activeWindow = 'tradeSkills'">Trade Skills</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showCommandLine = !showCommandLine; activeWindow = 'cmd'">Command Line</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showInventoryBelt = !showInventoryBelt; activeWindow = 'belt'">Belt</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showInventorySack = !showInventorySack; activeWindow = 'sack'">Sack</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showEquipment = !showEquipment; activeWindow = 'equipment'">Equipment</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showParty = !showParty; activeWindow = 'party'">Party</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item"
               (click)="showTraits = !showTraits; activeWindow = 'traits'">Traits</a>
          </li>
          <li class="divider dropdown-divider" *ngIf="inGame"></li>
          <li>
            <a class="dropdown-item" (click)="options.show()">Options</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="debugOptions.show()">Debug Options</a>
          </li>
          <li *ngIf="inGame">
            <a class="dropdown-item" (click)="cleanupWindows()">Clean Up Windows</a>
          </li>
        </ul>

      </li>
    </ul>

    <ul class="navbar-nav mr-auto" *ngIf="inGame">
      <li class="nav-item" *ngIf="colyseus.lobby.myAccount" dropdown container="body">
        <a class="nav-link" href="#" dropdownToggle>Macros</a>

        <ul *dropdownMenu class="dropdown-menu">
          <li>
            <a class="dropdown-item" (click)="macros.show()">Macros</a>
          </li>
          <li>
            <a class="dropdown-item" (click)="macroGroups.show()">Macro Groups</a>
          </li>
        </ul>

      </li>
    </ul>

    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href="#">Daily Reset in {{ timestampDisplay }}</a>
      </li>
    </ul>
  </div>
</nav>

<div class="body-container">

  <div *ngIf="!colyseus.isConnected" class="m-5 d-flex justify-content-center align-content-center h-100">
    <div class="alert alert-warning connection-warning">
      The game client could not connect to the server. The game may be down for maintenance. Refresh the page to attempt to reconnect.
    </div>
  </div>

  <!-- LOBBY WINDOWS -->
  <div class="window lobby game-window"
       [class.active-window]="activeWindow === 'lobby'"
       (click)="setActiveWindow('lobby')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="lobbyDrag"
       [windowLocation]="windowLocations.Lobby"
       windowName="lobby"
       defaultX="299"
       defaultY="55"
       [class.minimized]="minimized['lobby']"
       [class.hidden]="!loggedIn || !colyseus.username || !colyseus.isConnected || (inGame && autoHideLobby)">
    <div class="window-header text-center" #lobbyDrag>
      Lobby Chat ({{ colyseus.lobby.lobbyState.accounts.length }} Online<span *ngIf="colyseus.isDiscordConnected"> - Discord Connected</span>)
      <em *ngIf="newMessages > 0"> *{{ newMessages }} new message<span *ngIf="newMessages > 1">s</span>!</em>
      <app-minimize-button (click)="minimize('lobby')"></app-minimize-button>
    </div>
    <div class="window-body" [class.hidden]="minimized['lobby']">
      <app-lobby></app-lobby>
    </div>
  </div>

  <div class="window character-select"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="characterSelectDrag"
       windowName="chararacterSelect"
       [windowLocation]="windowLocations.CharacterSelect"
       defaultX="0"
       defaultY="55"
       [class.hidden]="!loggedIn || inGame || !colyseus.username || !colyseus.isConnected">
    <div class="window-header text-center" #characterSelectDrag>Character Select</div>
    <div class="window-body">
      <app-character-select [resourcesLoaded]="resourcesLoaded"></app-character-select>
    </div>
  </div>

  <!-- GAME WINDOWS -->
  <div class="window map"
       [class.active-window]="activeWindow === 'map'"
       (click)="setActiveWindow('map')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="mapDrag"
       windowName="map"
       [windowLocation]="windowLocations.Map"
       defaultX="389"
       defaultY="56"
       *ngIf="inGame">
    <div class="window-header text-center" #mapDrag>
      World
      <app-close-button (click)="colyseus.game.quit()"></app-close-button>
    </div>
    <div class="window-body">
      <app-active-target *ngIf="showActiveTarget"></app-active-target>
      <app-map [class.hidden]="colyseus.game.isChangingMap"></app-map>
    </div>
  </div>

  <div class="window stats above-game-window"
       [class.active-window]="activeWindow === 'stats'"
       (click)="setActiveWindow('stats')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="statsDrag"
       windowName="stats"
       [windowLocation]="windowLocations.Stats"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showStatsWindow">
    <div class="window-header text-center" #statsDrag>
      Stats
      <app-close-button (click)="showStatsWindow = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-stats-window [currentPlayer]="colyseus.game.character"></app-stats-window>
    </div>
  </div>

  <div class="window skills above-game-window"
       [class.active-window]="activeWindow === 'skills'"
       (click)="setActiveWindow('skills')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="skillsDrag"
       windowName="skills"
       [windowLocation]="windowLocations.Skills"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showSkillsWindow">
    <div class="window-header text-center" #skillsDrag>
      Skills
      <app-close-button (click)="showSkillsWindow = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-skills-window [currentPlayer]="colyseus.game.character"></app-skills-window>
    </div>
  </div>

  <div class="window skills above-game-window"
       [class.active-window]="activeWindow === 'tradeSkills'"
       (click)="setActiveWindow('tradeSkills')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="tradeSkillsDrag"
       windowName="tradeSkills"
       [windowLocation]="windowLocations.TradeSkills"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showTradeSkillsWindow">
    <div class="window-header text-center" #tradeSkillsDrag>
      Trade Skills
      <app-close-button (click)="showTradeSkillsWindow = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-tradeskills-window [currentPlayer]="colyseus.game.character"></app-tradeskills-window>
    </div>
  </div>

  <div class="window command-line game-window"
       [class.active-window]="activeWindow === 'cmd'"
       (click)="setActiveWindow('cmd')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="commandLine"
       windowName="commandLine"
       [windowLocation]="windowLocations.CommandLine"
       defaultX="389"
       defaultY="848"
       *ngIf="inGame && showCommandLine">
    <div class="window-header text-center" #commandLine>
      Command Line
      <app-close-button (click)="showCommandLine = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-command-line [rightClickSend]="rightClickSend"></app-command-line>
    </div>
  </div>

  <div class="window log-window game-window"
       [class.active-window]="activeWindow === 'log'"
       (click)="setActiveWindow('log')"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[logWindowSize]"
       [windowHandle]="logWindow"
       windowName="logWindow"
       [windowLocation]="windowLocations.Log"
       defaultX="3"
       defaultY="365"
       *ngIf="inGame">
    <div class="window-header text-center" #logWindow>
      Log
    </div>
    <div class="window-body">
      <app-log-window [windowSize]="logWindowSize"
                      [fontSize]="logFontSize"></app-log-window>
    </div>
  </div>

  <div class="window status-window game-window"
       [class.active-window]="activeWindow === 'status'"
       (click)="setActiveWindow('status')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="statusWindow"
       windowName="statusWindow"
       [windowLocation]="windowLocations.Status"
       defaultX="389"
       defaultY="743"
       [class.minimized]="minimized['status']"
       *ngIf="inGame">
    <div class="window-header text-center" #statusWindow>
      <app-character-tagline [player]="colyseus.game.character"></app-character-tagline>
      <app-minimize-button (click)="minimize('status')"></app-minimize-button>
    </div>
    <div class="window-body" [class.hidden]="minimized['status']">
      <app-status-window></app-status-window>
    </div>
  </div>

  <div class="window ground-window game-window"
       [class.active-window]="activeWindow === 'ground'"
       (click)="setActiveWindow('ground')"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[groundSize]"
       [windowHandle]="groundWindow"
       windowName="groundWindow"
       [windowLocation]="windowLocations.Ground"
       defaultX="3"
       defaultY="625"
       *ngIf="inGame && colyseus.game.showGround">
    <div class="window-header text-center" #groundWindow>
      Ground
      <app-close-button (click)="colyseus.game.showGround = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-ground [size]="groundSize"></app-ground>
    </div>
  </div>

  <div class="window inventory-sack-window game-window"
       [class.active-window]="activeWindow === 'sack'"
       (click)="setActiveWindow('sack')"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[sackSize]"
       [windowHandle]="sackWindow"
       windowName="sackWindow"
       [windowLocation]="windowLocations.Sack"
       defaultX="966"
       defaultY="538"
       *ngIf="inGame && showInventorySack">
    <div class="window-header text-center" #sackWindow>
      Inventory - Sack
      <app-close-button (click)="showInventorySack = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-inventory-sack [size]="sackSize"></app-inventory-sack>
    </div>
  </div>

  <div class="window inventory-belt-window game-window"
       [class.active-window]="activeWindow === 'belt'"
       (click)="setActiveWindow('belt')"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[beltSize]"
       [windowHandle]="beltWindow"
       windowName="beltWindow"
       [windowLocation]="windowLocations.Belt"
       defaultX="966"
       defaultY="433"
       *ngIf="inGame && showInventoryBelt">
    <div class="window-header text-center" #beltWindow>
      Inventory - Belt
      <app-close-button (click)="showInventoryBelt = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-inventory-belt [size]="beltSize"></app-inventory-belt>
    </div>
  </div>

  <div class="window equipment-window game-window"
       [class.active-window]="activeWindow === 'equipment'"
       (click)="setActiveWindow('equipment')"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[equipmentSize]"
       [windowHandle]="equipmentWindow"
       windowName="equipmentWindow"
       [windowLocation]="windowLocations.Equipment"
       defaultX="966"
       defaultY="56"
       *ngIf="inGame && showEquipment">
    <div class="window-header text-center" #equipmentWindow>
      Equipment
      <app-close-button (click)="showEquipment = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-equipment [player]="colyseus.game.character" [size]="equipmentSize"></app-equipment>
    </div>
  </div>

  <div class="window npc-window game-window"
       [class.active-window]="activeWindow === 'npcs'"
       (click)="setActiveWindow('npcs')"
       [appDraggableWindow]="!lockWindowPositions"
       [ngClass]="[npcWindowSize]"
       [windowHandle]="npcWindow"
       windowName="npcWindow"
       [windowLocation]="windowLocations.NPCs"
       defaultX="3"
       defaultY="56"
       *ngIf="inGame">
    <div class="window-header text-center" #npcWindow>
      NPCs
    </div>
    <div class="window-body">
      <app-npcs></app-npcs>
    </div>
  </div>

  <div class="window macro-bars game-window"
       [class.active-window]="activeWindow === 'macros'"
       (click)="setActiveWindow('macros')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="macroBars"
       windowName="macroBars"
       [windowLocation]="windowLocations.Macros"
       defaultX="389"
       defaultY="661"
       *ngIf="inGame">
    <div class="window-header text-center" #macroBars>
      Macros
    </div>
    <div class="window-body">
      <app-macro-bars></app-macro-bars>
    </div>
  </div>

  <div class="window trainer above-game-window"
       [class.active-window]="activeWindow === 'trainer'"
       (click)="setActiveWindow('trainer')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="trainerDrag"
       windowName="trainer"
       [windowLocation]="windowLocations.Trainer"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showTrainer.uuid">
    <div class="window-header text-center" #trainerDrag>
      {{ colyseus.game.showTrainer.classTrain }} Guide
      <app-close-button (click)="colyseus.game.showTrainer = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-trainer></app-trainer>
    </div>
  </div>

  <div class="window shop above-game-window"
       [class.active-window]="activeWindow === 'shop'"
       (click)="setActiveWindow('shop')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="shopDrag"
       windowName="shop"
       [windowLocation]="windowLocations.Shop"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showShop.uuid">
    <div class="window-header text-center" #shopDrag>
      Shop
      <app-close-button (click)="colyseus.game.showShop = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-shop></app-shop>
    </div>
  </div>

  <div class="window bank above-game-window"
       [class.active-window]="activeWindow === 'bank'"
       (click)="setActiveWindow('bank')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="bankDrag"
       windowName="bank"
       [windowLocation]="windowLocations.Bank"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showBank.uuid">
    <div class="window-header text-center" #bankDrag>
      {{ colyseus.game.showBank.bankId }} Bank
      <app-close-button (click)="colyseus.game.showBank = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-bank></app-bank>
    </div>
  </div>

  <div class="window locker above-game-window"
       [class.active-window]="activeWindow === 'locker'"
       (click)="setActiveWindow('locker')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="lockerDrag"
       windowName="locker"
       [windowLocation]="windowLocations.Locker"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showLocker.length > 0">
    <div class="window-header text-center" #lockerDrag>
      {{ colyseus.game.showLocker[0].regionId }} Region Wardrobe
      <app-close-button (click)="colyseus.game.showLocker = []"></app-close-button>
    </div>
    <div class="window-body">
      <app-lockers></app-lockers>
    </div>
  </div>

  <div class="window party above-game-window"
       [class.active-window]="activeWindow === 'party'"
       (click)="setActiveWindow('party')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="partyDrag"
       windowName="party"
       [windowLocation]="windowLocations.Party"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showParty">
    <div class="window-header text-center" #partyDrag>
      Party: {{ colyseus.game.character.partyName || '(no party)' }}
      <app-close-button (click)="showParty = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-party></app-party>
    </div>
  </div>

  <div class="window traits above-game-window"
       [class.active-window]="activeWindow === 'traits'"
       (click)="setActiveWindow('traits')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="traitsDrag"
       windowName="traits"
       [windowLocation]="windowLocations.Traits"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && showTraits">
    <div class="window-header text-center" #traitsDrag>
      Traits ({{ colyseus.game.character.traitPoints || 0 }} Trait Points, {{ colyseus.game.character.partyPoints || 0}} Party Points)
      <app-close-button (click)="showTraits = false"></app-close-button>
    </div>
    <div class="window-body">
      <app-traits></app-traits>
    </div>
  </div>

  <div class="window trade-skill alchemy above-game-window"
       [class.active-window]="activeWindow === 'tradeskillAlchemy'"
       (click)="setActiveWindow('tradeskillAlchemy')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="tradeskillAlchemyDrag"
       windowName="tradeskillAlchemy"
       [windowLocation]="windowLocations.TradeskillAlchemy"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showAlchemy.uuid">
    <div class="window-header text-center" #tradeskillAlchemyDrag>
      Alchemy
      <app-close-button (click)="colyseus.game.showAlchemy = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-tradeskill-alchemy></app-tradeskill-alchemy>
    </div>
  </div>

  <div class="window trade-skill spellforging above-game-window"
       [class.active-window]="activeWindow === 'tradeskillSpellforging'"
       (click)="setActiveWindow('tradeskillSpellforging')"
       [appDraggableWindow]="!lockWindowPositions"
       [windowHandle]="tradeskillSpellforgingDrag"
       windowName="tradeskillSpellforging"
       [windowLocation]="windowLocations.TradeskillSpellforging"
       defaultX="670"
       defaultY="120"
       *ngIf="inGame && colyseus.game.showSpellforging.uuid">
    <div class="window-header text-center" #tradeskillSpellforgingDrag>
      Spellforging
      <app-close-button (click)="colyseus.game.showSpellforging = {}"></app-close-button>
    </div>
    <div class="window-body">
      <app-tradeskill-spellforging></app-tradeskill-spellforging>
    </div>
  </div>

</div>

<div class="modal fade" bsModal #options="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title pull-left">Options</h3>
        <button type="button" class="close pull-right" (click)="options.hide()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="options.isShown">
        <div class="row">
          <div class="col text-center"><h4>UI Window Sizes</h4></div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Sack Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="sackSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Belt Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="beltSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Equipment Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="equipmentSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Ground Icons</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="groundSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Log Font Size</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="xlarge">Gigantic</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="large">Large</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="logFontSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Log Window Size</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="max">Max</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="xlarge">Gigantic</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="large">Large</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="logWindowSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">NPC Window Size</div>
          <div class="col">
            <div class="btn-group">
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="max">Max</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="xlarge">Gigantic</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="large">Large</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="normal">Normal</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="small">Small</label>
              <label class="btn btn-info" [(ngModel)]="npcWindowSize" btnRadio="xsmall">Miniature</label>
            </div>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col text-center"><h4>UI Options</h4></div>
        </div>

        <div class="row">
          <div class="col-3 text-right font-weight-bold">Theme</div>
          <div class="col form-check">
            <select class="form-control" [(ngModel)]="theme">
              <option [value]="'Light'">Light</option>
              <option [value]="'Dark'">Dark</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="rightClickSend">
              <input type="checkbox" class="form-check-input" [(ngModel)]="rightClickSend" id="rightClickSend"/>
              Right-click to send command line
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="autoHideLobby">
              <input type="checkbox" class="form-check-input" [(ngModel)]="autoHideLobby" id="autoHideLobby"/>
              Hide lobby while game is open
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="lockWindowPositions">
              <input type="checkbox" class="form-check-input" [(ngModel)]="lockWindowPositions" id="lockWindowPositions"/>
              Lock All Window Positions
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="noFantasy">
              <input type="checkbox" class="form-check-input" [(ngModel)]="noFantasy" id="noFantasy"/>
              Turn Off Fantasy Font
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="suppressZeroDamage">
              <input type="checkbox" class="form-check-input" [(ngModel)]="suppressZeroDamage" id="suppressZeroDamage"/>
              Suppress 0-damage messages
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="showActiveTarget">
              <input type="checkbox" class="form-check-input" [(ngModel)]="showActiveTarget" id="showActiveTarget"/>
              Show Current Target Information (Ctrl-Click to select without attacking)
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="pinLastTarget">
              <input type="checkbox" class="form-check-input" [(ngModel)]="pinLastTarget" id="pinLastTarget"/>
              Pin Last Target Click Position
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="sortNPCsByDistance">
              <input type="checkbox" class="form-check-input" [(ngModel)]="sortNPCsByDistance" id="sortNPCsByDistance"/>
              Sort NPCs by Distance
            </label>
          </div>
        </div>


        <div class="row mt-2">
          <div class="col text-center"><h4>Audio Options</h4></div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="playBackgroundMusic">
              <input type="checkbox" class="form-check-input" [(ngModel)]="playBackgroundMusic" id="playBackgroundMusic"/>
              Play Background Music
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col-9 ml-auto form-check">
            <label class="form-check-label" for="playSoundEffects">
              <input type="checkbox" class="form-check-input" [(ngModel)]="playSoundEffects" id="playSoundEffects"/>
              Play Sound Effects
            </label>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #macros="bs-modal" tabindex="-1" (onShow)="showMacroModal()">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">All Macros</h3>
        <button type="button" class="close pull-right" (click)="macros.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body macro-list-body" *ngIf="macroService.hasLoaded && macros.isShown">
        <div class="row mb-1 activate-inner-on-hover" *ngFor="let macro of macroService.allMacroNames()">
          <div class="col-2">
            <app-icon [name]="macroService.allMacros[macro].icon"
                      [bgColor]="macroService.allMacros[macro].background || '#ccc'"
                      [fgColor]="macroService.allMacros[macro].foreground"
                      size="small"></app-icon>
          </div>
          <div class="col-6">
            {{ macro }}
          </div>
          <div class="col-4">
            <div class="show-on-hover">
              <button class="btn btn-info btn-sm"
                      *ngIf="!macroService.allMacros[macro].isSystem" (click)="editMacro(macroService.allMacros[macro])">
                Edit
              </button>
              <button class="btn btn-info btn-sm"
                      *ngIf="macroService.allMacros[macro].isSystem" (click)="copyMacro(macroService.allMacros[macro])">
                Copy
              </button>
              <button class="btn btn-danger btn-sm"
                      *ngIf="!macroService.allMacros[macro].isSystem"
                      (click)="deleteMacro(macroService.allMacros[macro])">Remove
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-info" (click)="macros.hide(); macroGroups.show()">To Macro Groups</button>
        <div>
          <button type="button" class="btn btn-primary" (click)="addMacro()">New Macro</button>
          <button type="button" class="btn btn-secondary" (click)="macros.hide()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #viewMacro="bs-modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Edit Macro</h3>
        <button type="button" class="close pull-right" (click)="viewMacro.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="viewMacro.isShown">

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Name</div>
          <div class="col-9">
            <input class="form-control" [(ngModel)]="currentlyEditingMacro.name" placeholder="Enter your macro name"/>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Macro</div>
          <div class="col-9">
            <textarea class="form-control" rows="3" [(ngModel)]="currentlyEditingMacro.macro"
                      placeholder="Enter your macro command. Separate multiple commands with semicolons"></textarea>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Key</div>
          <div class="col-3">
            <input class="form-control" [(ngModel)]="currentlyEditingMacro.key" (keydown)="setMacroKey($event)"
                   placeholder="Press Key"/>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.shift"
                    [class.btn-success]="currentlyEditingMacro.modifiers.shift"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.shift">Shift
            </button>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.ctrl"
                    [class.btn-success]="currentlyEditingMacro.modifiers.ctrl"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.ctrl">Ctrl
            </button>
          </div>
          <div class="col-2">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.modifiers.alt"
                    [class.btn-success]="currentlyEditingMacro.modifiers.alt"
                    btnCheckbox
                    [(ngModel)]="currentlyEditingMacro.modifiers.alt">Alt
            </button>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">Mode</div>
          <div class="col-9">
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.clickToTarget"
                    [class.btn-success]="currentlyEditingMacro.clickToTarget"
                    (click)="changeMacroMode('clickToTarget')"
                    tooltip="Clicking this macro will let you click an npc target"
            >Need Target
            </button>
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.autoActivate"
                    [class.btn-success]="currentlyEditingMacro.autoActivate"
                    (click)="changeMacroMode('autoActivate')"
                    tooltip="Clicking this macro will fire it instantly"
            >Instant
            </button>
            <button class="btn"
                    [class.btn-secondary]="!currentlyEditingMacro.lockActivation"
                    [class.btn-success]="currentlyEditingMacro.lockActivation"
                    (click)="changeMacroMode('lockActivation')"
                    tooltip="Clicking this macro will make it your default click action (similar to Attack)"
            >Locked
            </button>
          </div>
        </div>

        <div class="row mb-1">
          <div class="col-3 text-right font-weight-bold">FG Color</div>
          <div class="col-3">
            <input class="form-control"
                   cpPosition="bottom"
                   cpAlphaChannel="disabled"
                   [(colorPicker)]="currentlyEditingMacro.foreground"
                   [style.background]="currentlyEditingMacro.foreground"
                   [value]="currentlyEditingMacro.foreground"/>
          </div>
          <div class="col-3 text-right font-weight-bold">BG Color</div>
          <div class="col-3">
            <input class="form-control"
                   cpPosition="bottom"
                   cpAlphaChannel="disabled"
                   [(colorPicker)]="currentlyEditingMacro.background"
                   [style.background]="currentlyEditingMacro.background"
                   [value]="currentlyEditingMacro.background"/>
          </div>
        </div>

        <div class="row">
          <div class="col-6 ml-auto">
            <div class="row p-0">
              <div class="col-3">
                <button class="btn btn-info btn-sm" (click)="changePage(currentIconPage-1)">&lt;</button>
              </div>
              <div class="col-6 text-center">Page {{ currentIconPage+1 }}</div>
              <div class="col-3 text-right">
                <button class="btn btn-info btn-sm" (click)="changePage(currentIconPage+1)">&gt;</button>
              </div>
            </div>
            <div class="d-flex flex-wrap flex-row">
              <app-icon *ngFor="let icon of currentIconsInPage"
                        [name]="icon"
                        class="macro-sheet-macro"
                        [class.active-macro]="icon === currentlyEditingMacro.icon"
                        size="small"
                        (click)="currentlyEditingMacro.icon = icon"
                        [fgColor]="currentlyEditingMacro.foreground"
                        [bgColor]="currentlyEditingMacro.background"></app-icon>
            </div>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <div></div>
        <div>
          <button type="button" class="btn btn-primary" [disabled]="invalidMacro()" (click)="saveMacro()">Save Macro</button>
          <button type="button" class="btn btn-secondary" (click)="viewMacro.hide()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #macroGroups="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">All Macro Groups</h3>
        <button type="button" class="close pull-right" (click)="macroGroups.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body macro-list-body" *ngIf="macroService.hasLoaded && macroGroups.isShown">

        <div class="row mb-1">
          <h4 class="text-center w-100">Active Macro Groups</h4>
        </div>

        <div class="row pb-1 activate-inner-on-hover"
             [class.mb-5]="last"
             *ngFor="let group of macroService.visibleMacroGroups; let last = last; let first = first; let index = index">

          <div class="col-3" [class.hidden]="!group">
            <div class="text-center font-weight-bold">{{ group }} (#{{ index + 1 }})</div>
            <div class="text-center show-on-hover">
              <button class="btn btn-warning btn-sm" *ngIf="!first" (click)="removeActiveGroup(index)">Remove</button>
            </div>
          </div>

          <div class="col-9 d-flex flex-row" *ngIf="group">
            <div class="macrobar-item" *ngFor="let macroIdx of macroArray">

              <app-macro
                [macroRef]="macroService.allMacroGroups[group][macroIdx]"
                disableEffects="true"
              ></app-macro>

            </div>
          </div>
        </div>

        <div class="row mb-1">
          <h4 class="text-center w-100">All Macro Groups</h4>
          <h6 class="text-center w-100 font-italic">(right click to remove macro)</h6>
        </div>

        <div class="row pb-1 activate-inner-on-hover"
             [class.mb-3]="last"
             *ngFor="let group of macroService.iterableMacroGroups; let last = last">

          <div class="col-3">
            <div class="text-center font-weight-bold">{{ group.key }}</div>
            <div class="text-center show-on-hover">
              <button class="btn btn-primary btn-sm" (click)="makeActiveGroup(group.key, 0)">1</button>
              <button class="btn btn-primary btn-sm" (click)="makeActiveGroup(group.key, 1)">2</button>
              <button class="btn btn-primary btn-sm" (click)="makeActiveGroup(group.key, 2)">3</button>

              <button class="btn btn-warning btn-sm" *ngIf="group.key === 'default'" (click)="resetDefaultGroup()">Reset</button>
              <button class="btn btn-danger btn-sm" *ngIf="group.key !== 'default'" (click)="deleteGroup(group.key)">
                Delete
              </button>
            </div>
          </div>

          <div class="col-9 d-flex flex-row">
            <div class="macrobar-item" *ngFor="let macroIdx of macroArray">

              <app-macro
                (click)="resetVariablesForMacroPopover(group.key, macroIdx)"
                (contextmenu)="unsetMacro(group.key, macroIdx)"
                [popover]="macroSelectorPopover"
                container="body"
                containerClass="macro-popover"
                outsideClick="true"
                [triggers]="'click'"
                [macroRef]="macroService.allMacroGroups[group.key][macroIdx]"
                disableEffects="true"
              ></app-macro>

            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-info" (click)="macroGroups.hide(); macros.show()">To Macros</button>
          <div>
            <button type="button" class="btn btn-primary" (click)="addMacroGroup()">New Macro Group</button>
            <button type="button" class="btn btn-secondary" (click)="macroGroups.hide()">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #debugOptions="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Debug Options</h3>
        <button type="button" class="close pull-right" (click)="debugOptions.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="debugOptions.isShown">
        <strong>Be careful, modifying these settings can break your game.</strong>

        <div class="row px-3 mt-3" *ngFor="let key of assetService.customKeys">
          <h6>{{ key }} url</h6>
          <input type="text"
                 class="form-control"
                 [placeholder]="assetService[key + 'Url']"
                 [(ngModel)]="assetService.customURLs[key]"
                 (change)="assetService.updateURLs()" />
        </div>
      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-warning" (click)="applyDebug()">Apply</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #silverModal="bs-modal" tabindex="-1">
  <div class="modal-dialog modal-lg silver-modal">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title pull-left">Buy and Spend Silver</h3>
        <button type="button" class="close pull-right" (click)="silverModal.hide()">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body" *ngIf="silverModal.isShown">

        <div class="top-container">
          <img src="http://rair.land/img/coin.png" width="64" height="64" /> You have {{ colyseus.lobby.myAccount.silver | number }} silver.
        </div>

        <tabset justified="true">
          <tab heading="Buy Silver">

            <div class="row mt-3">
              <div class="col-md-1"></div>
              <div class="text-center col-md-10">
                <div class="alert alert-info">
                  <strong>Hey, {{ colyseus.lobby.myAccount.username }}!</strong> Your purchases here are not treated as profits. All money earned goes back into making the game more sustainable, as well as paying for any help the dev team receives. This includes things like beefier servers, more resilient databases, and any royalties incurred. Subscriptions help me understand and adapt better than once-off purchases, but I appreciate all the support you can give. Thanks!
                </div>
              </div>
              <div class="col-md-1"></div>
            </div>

            <div class="row mt-3">
              <div class="col-md-6">
                <h4 class="text-center">Once-off</h4>

                {{ silverPricePoints | json }}
              </div>

              <div class="col-md-6">
                <h4 class="text-center">Subscribe</h4>

                <div class="text-center mt-3">
                  <a href="http://rair.land/docs/subscriber-benefits/" target="_blank">Click this link to see all the awesome perks of subscribing!</a>
                </div>

                <div class="mt-3">6.99/mo</div>

                <div class="text-center mt-3">If you're interested in trying before buying, contact a GM to set up a trial subscription. The trial will last 30 days, but you can always go back to playing for free.</div>
              </div>
            </div>

          </tab>

          <tab heading="Spend Silver">

            <div class="row mt-3" *ngFor="let purchaseItem of colyseus.lobby.lobbyState.silverPurchases">
              <div class="col-md-1">
                <div class="icon-container">
                  <app-icon [name]="purchaseItem.icon" [fgColor]="purchaseItem.fgColor"></app-icon>
                </div>
              </div>

              <div class="col-md-8">
                <div><strong>{{ purchaseItem.name }}</strong> ({{ getNumSilverItemPurchased(purchaseItem.key) }}/{{ purchaseItem.maxPurchases }})</div>
                <div>{{ purchaseItem.desc }}</div>
              </div>

              <div class="col-md-3">
                <button class="btn btn-primary btn-block"
                        (click)="doItemPurchase(purchaseItem)"
                        [disabled]="unableToPurchase(purchaseItem)">
                  Purchase for {{ purchaseItem.cost | number }} silver
                </button>
              </div>
            </div>

          </tab>
        </tabset>
      </div>

      <div class="modal-footer">
        <div></div>
        <button type="button" class="btn btn-warning" (click)="silverModal.hide()">Close</button>
      </div>
    </div>
  </div>
</div>

<ng-template #macroSelectorPopover>

  <div class="row px-1 mb-2">
    <div class="col-3">
      <button class="btn btn-info btn-sm" (click)="changeMacroPage(currentMacroPage-1)">&lt;</button>
    </div>
    <div class="col-6 text-center">Page {{ currentMacroPage+1 }}</div>
    <div class="col-3 text-right">
      <button class="btn btn-info btn-sm" (click)="changeMacroPage(currentMacroPage+1)">&gt;</button>
    </div>
  </div>

  <div class="d-flex flex-wrap flex-row">

    <app-icon *ngFor="let macro of currentMacrosInPage"
              class="m-1"
              [name]="macroService.allMacros[macro].icon"
              [bgColor]="macroService.allMacros[macro].background || '#ccc'"
              [fgColor]="macroService.allMacros[macro].foreground"
              [tooltip]="macroService.allMacros[macro].name"
              (click)="selectMacroForSpot(macro)"
              size="nsmall"></app-icon>
  </div>

</ng-template>

<img *ngFor="let asset of assetService.preloadAssets" class="hidden" [src]="asset" (load)="imageLoaded()" />

<div class="bottom-subscriber-reminder" *ngIf="!colyseus.isSubscribed">
  You're not currently subscribed. Please consider subscribing or buying silver to help keep the lights on (Game > Manage Silver)! Want to know what you get for subscribing?
  <br>
  <a href="http://rair.land/docs/subscriber-benefits/" target="_blank">Click this link to see all the awesome perks of subscribing!</a>
</div>
